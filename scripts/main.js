'use strict';function y(g,a,b,e){g.K.je(g.kc,a,b,e,void 0)}function A(g,a,b){return g.K.Xf(g.kc,a,b,void 0,void 0)}function I(g,a,b,e){g.K.nb?y(g,a,b,e):g.K.Ej()._OnMessageFromDOM({type:"event",component:g.kc,handler:a,dispatchOpts:e||null,data:b,responseId:null})}function J(g,a,b){g.K.S(g.kc,a,b)}function K(g,a){for(const [b,e]of a)J(g,b,e)}function L(g){g.Cd||(g.K.lj(g.bh),g.Cd=!0)}window.Ia=class{constructor(g,a){this.K=g;this.kc=a;this.Cd=!1;this.bh=()=>this.la()}Hf(){}la(){}};
function M(g){-1!==g.Wb&&(self.clearTimeout(g.Wb),g.Wb=-1)}window.Hi=class{constructor(g,a){this.Ue=g;this.Hl=a;this.Wb=-1;this.Dd=-Infinity;this.dh=()=>{this.Wb=-1;this.Dd=Date.now();this.qc=!0;this.Ue();this.qc=!1};this.Dg=this.qc=!1}l(){M(this);this.dh=this.Ue=null}};"use strict";
function N(g,a){const b=a.elementId,e=g.Of(b,a);g.Ca.set(b,e);a.isVisible||(e.style.display="none");e.addEventListener("focus",()=>{O(g,"elem-focused",b)});e.addEventListener("blur",()=>{O(g,"elem-blurred",b)});g.sd&&document.body.appendChild(e)}function P(g,a,b){J(g,a,e=>{const k=g.Ca.get(e.elementId);return b(k,e)})}function O(g,a,b,e){e||(e={});e.elementId=b;y(g,a,e)}function Q(g,a,b){var e;e||(e={});e.elementId=b;I(g,a,e)}
window.Oh=class extends self.Ia{constructor(g,a){super(g,a);this.Ca=new Map;this.sd=!0;K(this,[["create",b=>N(this,b)],["destroy",b=>{{b=b.elementId;const e=this.Ca.get(b);this.sd&&e.parentElement.removeChild(e);this.Ca.delete(b)}}],["set-visible",b=>{this.sd&&(this.Ca.get(b.elementId).style.display=b.isVisible?"":"none")}],["update-position",b=>{if(this.sd){var e=this.Ca.get(b.elementId);e.style.left=b.left+"px";e.style.top=b.top+"px";e.style.width=b.width+"px";e.style.height=b.height+"px";b=b.fontSize;
null!==b&&(e.style.fontSize=b+"em")}}],["update-state",b=>{{const e=this.Ca.get(b.elementId);this.ve(e,b)}}],["focus",b=>this.Ne(b)],["set-css-style",b=>{this.Ca.get(b.elementId).style[b.prop]=b.val}],["set-attribute",b=>{this.Ca.get(b.elementId).setAttribute(b.name,b.val)}],["remove-attribute",b=>{this.Ca.get(b.elementId).removeAttribute(b.name)}]]);P(this,"get-element",b=>b)}Of(){throw Error("required override");}ve(){throw Error("required override");}Ne(g){var a=this.Ca.get(g.elementId);g.focus?
a.focus():a.blur()}};"use strict";
{const g=/(iphone|ipod|ipad|macos|macintosh|mac os x)/i.test(navigator.userAgent);let a=0;function b(q){const h=document.createElement("script");h.async=!1;h.type="module";return q.Xl?new Promise(r=>{const t="c3_resolve_"+a;++a;self[t]=r;h.textContent=q.$l+`\n\nself["${t}"]();`;document.head.appendChild(h)}):new Promise((r,t)=>{h.onload=r;h.onerror=t;h.src=q;document.head.appendChild(h)})}let e=!1,k=!1;function u(){if(!e){try{new Worker("blob://",{get type(){k=!0}})}catch(q){}e=!0}return k}let n=
new Audio;const f={"audio/webm; codecs=opus":!!n.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!n.canPlayType("audio/ogg; codecs=opus"),"audio/webm; codecs=vorbis":!!n.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!n.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!n.canPlayType("audio/mp4"),"audio/mpeg":!!n.canPlayType("audio/mpeg")};n=null;async function m(q){q=await c(q);return(new TextDecoder("utf-8")).decode(q)}function c(q){return new Promise((h,
r)=>{const t=new FileReader;t.onload=x=>h(x.target.result);t.onerror=x=>r(x);t.readAsArrayBuffer(q)})}const d=[];let p=0;window.RealFile=window.File;const v=[],w=new Map,z=new Map;let F=0;const E=[];self.runOnStartup=function(q){if("function"!==typeof q)throw Error("runOnStartup called without a function");E.push(q)};const H=new Set(["cordova","playable-ad","instant-games"]);let l=!1;window.ra=class q{constructor(h){this.nb=h.bm;this.kb=null;this.Y="";this.Od=h.Zl;this.Tc={};this.Ob=this.Sc=null;
this.yd=[];this.xc=this.U=this.Ub=null;this.Tb=-1;this.Rl=()=>this.tk();this.Sb=[];this.J=h.eh;!this.nb||"undefined"!==typeof OffscreenCanvas&&navigator.userActivation&&u()||(this.nb=!1);H.has(this.J)&&this.nb&&(console.warn("[C3 runtime] Worker mode is enabled and supported, but is currently disabled in WebViews. Reverting to DOM mode."),this.nb=!1);this.Id=this.Ya=null;"html5"!==this.J&&"playable-ad"!==this.J||"file"!==location.protocol.substr(0,4)||alert("Exported games won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)");
this.S("runtime","cordova-fetch-local-file",r=>this.Uj(r));this.S("runtime","create-job-worker",()=>this.Vj());"cordova"===this.J?document.addEventListener("deviceready",()=>this.ng(h)):this.ng(h)}l(){this.xe();this.kb&&(this.kb=this.kb.onmessage=null);this.Sc&&(this.Sc.terminate(),this.Sc=null);this.Ob&&(this.Ob.l(),this.Ob=null);this.U&&(this.U.parentElement.removeChild(this.U),this.U=null)}Wf(){return g&&"cordova"===this.J}ie(){return g&&H.has(this.J)||navigator.standalone}async ng(h){"macos-wkwebview"===
this.J&&this.Re({type:"ready"});if("playable-ad"===this.J){this.Ya=self.c3_base64files;this.Id={};await this.qj();for(let t=0,x=h.Yb.length;t<x;++t){var r=h.Yb[t].toLowerCase();this.Id.hasOwnProperty(r)?h.Yb[t]={Xl:!0,$l:this.Id[r]}:this.Ya.hasOwnProperty(r)&&(h.Yb[t]=URL.createObjectURL(this.Ya[r]))}}h.Tl?this.Y=h.Tl:(r=location.origin,this.Y=("null"===r?"file:///":r)+location.pathname,r=this.Y.lastIndexOf("/"),-1!==r&&(this.Y=this.Y.substr(0,r+1)));h.dm&&(this.Tc=h.dm);r=new MessageChannel;this.kb=
r.port1;this.kb.onmessage=t=>this._OnMessageFromRuntime(t.data);window.c3_addPortMessageHandler&&window.c3_addPortMessageHandler(t=>this.kk(t));this.xc=new self.ri(this);await R(this.xc);"object"===typeof window.StatusBar&&window.StatusBar.hide();"object"===typeof window.AndroidFullScreen&&window.AndroidFullScreen.immersiveMode();this.nb?await this.Kj(h,r.port2):await this.Jj(h,r.port2)}Ae(h){h=this.Tc.hasOwnProperty(h)?this.Tc[h]:h.endsWith("/workermain.js")&&this.Tc.hasOwnProperty("workermain.js")?
this.Tc["workermain.js"]:"playable-ad"===this.J&&this.Ya.hasOwnProperty(h.toLowerCase())?this.Ya[h.toLowerCase()]:h;h instanceof Blob&&(h=URL.createObjectURL(h));return h}async ae(h,r,t){if(h.startsWith("blob:"))return new Worker(h,t);if(this.Wf()&&"file:"===location.protocol)return h=await this.Vc(this.Od+h),new Worker(URL.createObjectURL(new Blob([h],{type:"application/javascript"})),t);h=new URL(h,r);if(location.origin!==h.origin){h=await fetch(h);if(!h.ok)throw Error("failed to fetch worker script");
h=await h.blob();return new Worker(URL.createObjectURL(h),t)}return new Worker(h,t)}sb(){return Math.max(window.innerWidth,1)}rb(){return Math.max(window.innerHeight,1)}kg(h){var r=this.xc;return{baseUrl:this.Y,windowInnerWidth:this.sb(),windowInnerHeight:this.rb(),devicePixelRatio:window.devicePixelRatio,isFullscreen:q.bc(),projectData:h.jm,previewImageBlobs:window.cr_previewImageBlobs||this.Ya,previewProjectFileBlobs:window.cr_previewProjectFileBlobs,previewProjectFileSWUrls:window.cr_previewProjectFiles,
swClientId:window.hm||"",exportType:h.eh,isDebug:-1<self.location.search.indexOf("debug"),ife:!!self.im,jobScheduler:{inputPort:r.ff,outputPort:r.tf,maxNumWorkers:r.Nl},supportedAudioFormats:f,opusWasmScriptUrl:window.cr_opusWasmScriptUrl||this.Od+"opus.wasm.js",opusWasmBinaryUrl:window.cr_opusWasmBinaryUrl||this.Od+"opus.wasm.wasm",isiOSCordova:this.Wf(),isiOSWebView:this.ie(),isFBInstantAvailable:"undefined"!==typeof self.FBInstant}}async Kj(h,r){var t=this.Ae(h.cm);this.Sc=await this.ae(t,this.Y,
{type:"module",name:"Runtime"});this.U=document.createElement("canvas");this.U.style.display="none";t=this.U.transferControlToOffscreen();document.body.appendChild(this.U);window.c3canvas=this.U;this.Sc.postMessage(Object.assign(this.kg(h),{type:"init-runtime",isInWorker:!0,messagePort:r,canvas:t,workerDependencyScripts:h.Ff||[],engineScripts:h.Yb,projectScripts:h.mh,mainProjectScript:h.hh,projectScriptsStatus:self.C3_ProjectScriptsStatus}),[r,t,...S(this.xc)]);this.yd=v.map(x=>new x(this));this.jg();
self.c3_callFunction=(x,C)=>this.Ub.Lj(x,C);"preview"===this.J&&(self.goToLastErrorScript=()=>this.je("runtime","go-to-last-error-script"))}async Jj(h,r){this.U=document.createElement("canvas");this.U.style.display="none";document.body.appendChild(this.U);window.c3canvas=this.U;this.yd=v.map(B=>new B(this));this.jg();var t=h.Yb.map(B=>"string"===typeof B?(new URL(B,this.Y)).toString():B);Array.isArray(h.Ff)&&t.unshift(...h.Ff);t=await Promise.all(t.map(B=>this.Ee(B)));await Promise.all(t.map(B=>b(B)));
t=self.C3_ProjectScriptsStatus;const x=h.hh,C=h.mh;for(let [B,D]of C)if(D||(D=B),B===x)try{D=await this.Ee(D),await b(D),"preview"!==this.J||t[B]||this.xg(B,"main script did not run to completion")}catch(G){this.xg(B,G)}else if("scriptsInEvents.js"===B||B.endsWith("/scriptsInEvents.js"))D=await this.Ee(D),await b(D);"preview"===this.J&&"object"!==typeof self.em.fm?(this.nd(),console.error("[C3 runtime] Failed to load JavaScript code used in events. Check all your JavaScript code has valid syntax."),
alert("Failed to load JavaScript code used in events. Check all your JavaScript code has valid syntax.")):(h=Object.assign(this.kg(h),{isInWorker:!1,messagePort:r,canvas:this.U,runOnStartupFunctions:E}),this.pg(),this.Ob=self.C3_CreateRuntime(h),await self.C3_InitRuntime(this.Ob,h))}xg(h,r){this.nd();console.error(`[Preview] Failed to load project main script (${h}): `,r);alert(`Failed to load project main script (${h}). Check all your JavaScript code has valid syntax. Press F12 and check the console for error details.`)}pg(){this.nd()}nd(){const h=
window.Ul;h&&(h.parentElement.removeChild(h),window.Ul=null)}async Vj(){const h=await T(this.xc);return{outputPort:h,transferables:[h]}}Ej(){if(this.nb)throw Error("not available in worker mode");return this.Ob}je(h,r,t,x,C){this.kb.postMessage({type:"event",component:h,handler:r,dispatchOpts:x||null,data:t,responseId:null},C)}Xf(h,r,t,x,C){const B=F++,D=new Promise((G,aa)=>{z.set(B,{resolve:G,reject:aa})});this.kb.postMessage({type:"event",component:h,handler:r,dispatchOpts:x||null,data:t,responseId:B},
C);return D}["_OnMessageFromRuntime"](h){const r=h.type;if("event"===r)return this.$j(h);if("result"===r)this.xk(h);else if("runtime-ready"===r)this.yk();else if("alert-error"===r)this.nd(),alert(h.message);else if("creating-runtime"===r)this.pg();else throw Error(`unknown message '${r}'`);}$j(h){const r=h.component,t=h.handler,x=h.data,C=h.responseId;if(h=w.get(r))if(h=h.get(t)){var B=null;try{B=h(x)}catch(D){console.error(`Exception in '${r}' handler '${t}':`,D);null!==C&&this.md(C,!1,""+D);return}if(null===
C)return B;B&&B.then?B.then(D=>this.md(C,!0,D)).catch(D=>{console.error(`Rejection from '${r}' handler '${t}':`,D);this.md(C,!1,""+D)}):this.md(C,!0,B)}else console.warn(`[DOM] No handler '${t}' for component '${r}'`);else console.warn(`[DOM] No event handlers for component '${r}'`)}md(h,r,t){let x;t&&t.transferables&&(x=t.transferables);this.kb.postMessage({type:"result",responseId:h,isOk:r,result:t},x)}xk(h){const r=h.responseId,t=h.isOk;h=h.result;const x=z.get(r);t?x.resolve(h):x.reject(h);z.delete(r)}S(h,
r,t){let x=w.get(h);x||(x=new Map,w.set(h,x));if(x.has(r))throw Error(`[DOM] Component '${h}' already has handler '${r}'`);x.set(r,t)}static Ha(h){if(v.includes(h))throw Error("DOM handler already added");v.push(h)}jg(){for(const h of this.yd)if("runtime"===h.kc){this.Ub=h;return}throw Error("cannot find runtime DOM handler");}kk(h){this.je("debugger","message",h)}yk(){for(const h of this.yd)h.Hf()}static bc(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||
l)}static od(h){l=!!h}lj(h){this.Sb.push(h);this.Qe()}bl(h){h=this.Sb.indexOf(h);if(-1===h)throw Error("invalid callback");this.Sb.splice(h,1);this.Sb.length||this.xe()}Qe(){-1===this.Tb&&this.Sb.length&&(this.Tb=requestAnimationFrame(this.Rl))}xe(){-1!==this.Tb&&(cancelAnimationFrame(this.Tb),this.Tb=-1)}tk(){this.Tb=-1;for(const h of this.Sb)h();this.Qe()}qb(h){this.Ub.qb(h)}Ib(h){this.Ub.Ib(h)}Pe(){this.Ub.Pe()}fd(h){this.Ub.fd(h)}oi(){return!!f["audio/webm; codecs=opus"]}async Fl(h){h=await this.Xf("runtime",
"opus-decode",{arrayBuffer:h},null,[h]);return new Float32Array(h)}ni(h){return/^(?:[a-z\-]+:)?\/\//.test(h)||"data:"===h.substr(0,5)||"blob:"===h.substr(0,5)}Vf(h){return!this.ni(h)}async Ee(h){return"cordova"===this.J&&(h.startsWith("file:")||"file:"===location.protocol&&this.Vf(h))?(h.startsWith(this.Y)&&(h=h.substr(this.Y.length)),h=await this.Vc(h),URL.createObjectURL(new Blob([h],{type:"application/javascript"}))):h}async Uj(h){const r=h.filename;switch(h.as){case "text":return await this.Nh(r);
case "buffer":return await this.Vc(r);default:throw Error("unsupported type");}}Nf(h){const r=window.cordova.file.applicationDirectory+"www/"+h.toLowerCase();return new Promise((t,x)=>{window.resolveLocalFileSystemURL(r,C=>{C.file(t,x)},x)})}async Nh(h){h=await this.Nf(h);return await m(h)}ye(){if(d.length&&!(8<=p)){p++;var h=d.shift();this.rj(h.filename,h.am,h.Wl)}}Vc(h){return new Promise((r,t)=>{d.push({filename:h,am:x=>{p--;this.ye();r(x)},Wl:x=>{p--;this.ye();t(x)}});this.ye()})}async rj(h,r,
t){try{const x=await this.Nf(h),C=await c(x);r(C)}catch(x){t(x)}}Re(h){if("windows-webview2"===this.J)window.chrome.webview.postMessage(JSON.stringify(h));else if("macos-wkwebview"===this.J)window.webkit.messageHandlers.C3Wrapper.postMessage(JSON.stringify(h));else throw Error("cannot send wrapper message");}async qj(){const h=[];for(const [r,t]of Object.entries(this.Ya))h.push(this.pj(r,t));await Promise.all(h)}async pj(h,r){if("object"===typeof r)this.Ya[h]=new Blob([r.str],{type:r.type}),this.Id[h]=
r.str;else{let t=await this.Bj(r);t||(t=this.vj(r));this.Ya[h]=t}}async Bj(h){try{return await (await fetch(h)).blob()}catch(r){return console.warn("Failed to fetch a data: URI. Falling back to a slower workaround. This is probably because the Content Security Policy unnecessarily blocked it. Allow data: URIs in your CSP to avoid this.",r),null}}vj(h){h=this.Vk(h);return this.oj(h.data,h.Yl)}Vk(h){var r=h.indexOf(",");if(0>r)throw new URIError("expected comma in data: uri");var t=h.substring(r+1);
r=h.substring(5,r).split(";");h=r[0]||"";const x=r[2];t="base64"===r[1]||"base64"===x?atob(t):decodeURIComponent(t);return{Yl:h,data:t}}oj(h,r){var t=h.length;let x=t>>2,C=new Uint8Array(t),B=new Uint32Array(C.buffer,0,x),D,G;for(G=D=0;D<x;++D)B[D]=h.charCodeAt(G++)|h.charCodeAt(G++)<<8|h.charCodeAt(G++)<<16|h.charCodeAt(G++)<<24;for(t&=3;t--;)C[G]=h.charCodeAt(G),++G;return new Blob([C],{type:r})}}}"use strict";
{const g=self.ra;function a(l){return l.sourceCapabilities&&l.sourceCapabilities.firesTouchEvents||l.originalEvent&&l.originalEvent.sourceCapabilities&&l.originalEvent.sourceCapabilities.firesTouchEvents}const b=new Map([["OSLeft","MetaLeft"],["OSRight","MetaRight"]]),e={dispatchRuntimeEvent:!0,dispatchUserScriptEvent:!0},k={dispatchUserScriptEvent:!0},u={dispatchRuntimeEvent:!0};function n(l){return new Promise((q,h)=>{const r=document.createElement("link");r.onload=()=>q(r);r.onerror=t=>h(t);r.rel=
"stylesheet";r.href=l;document.head.appendChild(r)})}function f(l){return new Promise((q,h)=>{const r=new Image;r.onload=()=>q(r);r.onerror=t=>h(t);r.src=l})}async function m(l){l=URL.createObjectURL(l);try{return await f(l)}finally{URL.revokeObjectURL(l)}}function c(l){return new Promise((q,h)=>{let r=new FileReader;r.onload=t=>q(t.target.result);r.onerror=t=>h(t);r.readAsText(l)})}async function d(l,q,h){if(!/firefox/i.test(navigator.userAgent))return await m(l);var r=await c(l);r=(new DOMParser).parseFromString(r,
"image/svg+xml");const t=r.documentElement;if(t.hasAttribute("width")&&t.hasAttribute("height")){const x=t.getAttribute("width"),C=t.getAttribute("height");if(!x.includes("%")&&!C.includes("%"))return await m(l)}t.setAttribute("width",q+"px");t.setAttribute("height",h+"px");r=(new XMLSerializer).serializeToString(r);l=new Blob([r],{type:"image/svg+xml"});return await m(l)}function p(l){do{if(l.parentNode&&l.hasAttribute("contenteditable"))return!0;l=l.parentNode}while(l);return!1}const v=new Set(["input",
"textarea","datalist","select"]),w=new Set(["canvas","body","html"]);function z(l){w.has(l.target.tagName.toLowerCase())&&l.preventDefault()}function F(l){(l.metaKey||l.ctrlKey)&&l.preventDefault()}self.C3_GetSvgImageSize=async function(l){l=await m(l);if(0<l.width&&0<l.height)return[l.width,l.height];{l.style.position="absolute";l.style.left="0px";l.style.top="0px";l.style.visibility="hidden";document.body.appendChild(l);const q=l.getBoundingClientRect();document.body.removeChild(l);return[q.width,
q.height]}};self.C3_RasterSvgImageBlob=async function(l,q,h,r,t){l=await d(l,q,h);const x=document.createElement("canvas");x.width=r;x.height=t;x.getContext("2d").drawImage(l,0,0,q,h);return x};let E=!1;document.addEventListener("pause",()=>E=!0);document.addEventListener("resume",()=>E=!1);function H(){try{return window.parent&&window.parent.document.hasFocus()}catch(l){return!1}}g.Ha(class extends self.Ia{constructor(l){super(l,"runtime");this.Kg=!0;this.Vb=-1;this.Af="any";this.yg=this.zg=!1;this.kf=
this.Kc=this.zb=null;l.S("canvas","update-size",r=>this.Sk(r));l.S("runtime","invoke-download",r=>this.hk(r));l.S("runtime","raster-svg-image",r=>this.uk(r));l.S("runtime","get-svg-image-size",r=>this.ck(r));l.S("runtime","set-target-orientation",r=>this.Ak(r));l.S("runtime","register-sw",()=>this.wk());l.S("runtime","post-to-debugger",r=>this.tg(r));l.S("runtime","go-to-script",r=>this.tg(r));l.S("runtime","before-start-ticking",()=>this.Rj());l.S("runtime","debug-highlight",r=>this.Wj(r));l.S("runtime",
"enable-device-orientation",()=>this.nj());l.S("runtime","enable-device-motion",()=>this.mj());l.S("runtime","add-stylesheet",r=>this.Pj(r));l.S("runtime","alert",r=>this.Ge(r));l.S("runtime","hide-cordova-splash",()=>this.dk());const q=new Set(["input","textarea","datalist"]);window.addEventListener("contextmenu",r=>{const t=r.target;q.has(t.tagName.toLowerCase())||p(t)||r.preventDefault()});const h=l.U;window.addEventListener("selectstart",z);window.addEventListener("gesturehold",z);h.addEventListener("selectstart",
z);h.addEventListener("gesturehold",z);window.addEventListener("touchstart",z,{passive:!1});"undefined"!==typeof PointerEvent?(window.addEventListener("pointerdown",z,{passive:!1}),h.addEventListener("pointerdown",z)):h.addEventListener("touchstart",z);this.Dc=0;window.addEventListener("mousedown",r=>{1===r.button&&r.preventDefault()});window.addEventListener("mousewheel",F,{passive:!1});window.addEventListener("wheel",F,{passive:!1});window.addEventListener("resize",()=>this.Tk());window.addEventListener("fullscreenchange",
()=>this.fc());window.addEventListener("webkitfullscreenchange",()=>this.fc());window.addEventListener("mozfullscreenchange",()=>this.fc());window.addEventListener("fullscreenerror",r=>this.Je(r));window.addEventListener("webkitfullscreenerror",r=>this.Je(r));window.addEventListener("mozfullscreenerror",r=>this.Je(r));l.ie()&&window.addEventListener("focusout",()=>{{const x=document.activeElement;if(x){var r=x.tagName.toLowerCase();var t=new Set("email number password search tel text url".split(" "));
r="textarea"===r?!0:"input"===r?t.has(x.type.toLowerCase()||"text"):p(x)}else r=!1}r||(document.scrollingElement.scrollTop=0)});self.C3WrapperOnMessage=r=>this.Uk(r);this.Pb=new Set;this.Jd=new WeakSet;this.jb=!1}Rj(){"cordova"===this.K.J?(document.addEventListener("pause",()=>this.Oe(!0)),document.addEventListener("resume",()=>this.Oe(!1))):document.addEventListener("visibilitychange",()=>this.Oe(document.hidden));return{isSuspended:!(!document.hidden&&!E)}}Hf(){window.addEventListener("focus",()=>
this.ic("window-focus"));window.addEventListener("blur",()=>{this.ic("window-blur",{parentHasFocus:H()});this.Dc=0});window.addEventListener("focusin",q=>{q=q.target;(v.has(q.tagName.toLowerCase())||p(q))&&this.ic("keyboard-blur")});window.addEventListener("keydown",q=>this.qg("keydown",q));window.addEventListener("keyup",q=>this.qg("keyup",q));window.addEventListener("dblclick",q=>this.Le("dblclick",q,e));window.addEventListener("wheel",q=>this.mk(q));"undefined"!==typeof PointerEvent?(window.addEventListener("pointerdown",
q=>{this.Be(q);this.hc("pointerdown",q)}),this.K.nb&&"undefined"!==typeof window.onpointerrawupdate&&self===self.top?(this.Kc=new self.Hi(()=>this.zj(),5),this.Kc.Dg=!0,window.addEventListener("pointerrawupdate",q=>this.rk(q))):window.addEventListener("pointermove",q=>this.hc("pointermove",q)),window.addEventListener("pointerup",q=>this.hc("pointerup",q)),window.addEventListener("pointercancel",q=>this.hc("pointercancel",q))):(window.addEventListener("mousedown",q=>{this.Be(q);this.Me("pointerdown",
q)}),window.addEventListener("mousemove",q=>this.Me("pointermove",q)),window.addEventListener("mouseup",q=>this.Me("pointerup",q)),window.addEventListener("touchstart",q=>{this.Be(q);this.ld("pointerdown",q)}),window.addEventListener("touchmove",q=>this.ld("pointermove",q)),window.addEventListener("touchend",q=>this.ld("pointerup",q)),window.addEventListener("touchcancel",q=>this.ld("pointercancel",q)));const l=()=>this.Pe();window.addEventListener("pointerup",l,!0);window.addEventListener("touchend",
l,!0);window.addEventListener("click",l,!0);window.addEventListener("keydown",l,!0);window.addEventListener("gamepadconnected",l,!0)}ic(l,q){y(this,l,q||null,u)}sb(){return this.K.sb()}rb(){return this.K.rb()}Tk(){const l=this.sb(),q=this.rb();this.ic("window-resize",{innerWidth:l,innerHeight:q,devicePixelRatio:window.devicePixelRatio,isFullscreen:g.bc()});this.K.ie()&&(-1!==this.Vb&&clearTimeout(this.Vb),this.ug(l,q,0))}cl(l,q,h){-1!==this.Vb&&clearTimeout(this.Vb);this.Vb=setTimeout(()=>this.ug(l,
q,h),48)}ug(l,q,h){const r=this.sb(),t=this.rb();this.Vb=-1;r!=l||t!=q?this.ic("window-resize",{innerWidth:r,innerHeight:t,devicePixelRatio:window.devicePixelRatio,isFullscreen:g.bc()}):10>h&&this.cl(r,t,h+1)}Ak(l){this.Af=l.targetOrientation}Bl(){const l=this.Af;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(l).catch(q=>console.warn("[Construct 3] Failed to lock orientation: ",q));else try{let q=!1;screen.lockOrientation?q=screen.lockOrientation(l):screen.webkitLockOrientation?
q=screen.webkitLockOrientation(l):screen.mozLockOrientation?q=screen.mozLockOrientation(l):screen.msLockOrientation&&(q=screen.msLockOrientation(l));q||console.warn("[Construct 3] Failed to lock orientation")}catch(q){console.warn("[Construct 3] Failed to lock orientation: ",q)}}fc(){const l=g.bc();l&&"any"!==this.Af&&this.Bl();y(this,"fullscreenchange",{isFullscreen:l,innerWidth:this.sb(),innerHeight:this.rb()})}Je(l){console.warn("[Construct 3] Fullscreen request failed: ",l);y(this,"fullscreenerror",
{isFullscreen:g.bc(),innerWidth:this.sb(),innerHeight:this.rb()})}Oe(l){l?this.K.xe():this.K.Qe();y(this,"visibilitychange",{hidden:l})}qg(l,q){"Backspace"===q.key&&z(q);const h=b.get(q.code)||q.code;I(this,l,{code:h,key:q.key,which:q.which,repeat:q.repeat,altKey:q.altKey,ctrlKey:q.ctrlKey,metaKey:q.metaKey,shiftKey:q.shiftKey,timeStamp:q.timeStamp},e)}mk(l){y(this,"wheel",{clientX:l.clientX,clientY:l.clientY,pageX:l.pageX,pageY:l.pageY,deltaX:l.deltaX,deltaY:l.deltaY,deltaZ:l.deltaZ,deltaMode:l.deltaMode,
timeStamp:l.timeStamp},e)}Le(l,q,h){a(q)||I(this,l,{button:q.button,buttons:q.buttons,clientX:q.clientX,clientY:q.clientY,pageX:q.pageX,pageY:q.pageY,timeStamp:q.timeStamp},h)}Me(l,q){if(!a(q)){var h=this.Dc;"pointerdown"===l&&0!==h?l="pointermove":"pointerup"===l&&0!==q.buttons&&(l="pointermove");I(this,l,{pointerId:1,pointerType:"mouse",button:q.button,buttons:q.buttons,lastButtons:h,clientX:q.clientX,clientY:q.clientY,pageX:q.pageX,pageY:q.pageY,width:0,height:0,pressure:0,tangentialPressure:0,
tiltX:0,tiltY:0,twist:0,timeStamp:q.timeStamp},e);this.Dc=q.buttons;this.Le(q.type,q,k)}}hc(l,q){if(this.Kc&&"pointermove"!==l){var h=this.Kc;h.qc||(M(h),h.Dd=Date.now())}h=0;"mouse"===q.pointerType&&(h=this.Dc);I(this,l,{pointerId:q.pointerId,pointerType:q.pointerType,button:q.button,buttons:q.buttons,lastButtons:h,clientX:q.clientX,clientY:q.clientY,pageX:q.pageX,pageY:q.pageY,width:q.width||0,height:q.height||0,pressure:q.pressure||0,tangentialPressure:q.tangentialPressure||0,tiltX:q.tiltX||0,
tiltY:q.tiltY||0,twist:q.twist||0,timeStamp:q.timeStamp},e);"mouse"===q.pointerType&&(h="mousemove","pointerdown"===l?h="mousedown":"pointerup"===l&&(h="mouseup"),this.Le(h,q,k),this.Dc=q.buttons)}rk(l){this.kf=l;l=this.Kc;if(-1===l.Wb){var q=Date.now(),h=q-l.Dd,r=l.Hl;h>=r&&l.Dg?(l.Dd=q,l.qc=!0,l.Ue(),l.qc=!1):l.Wb=self.setTimeout(l.dh,Math.max(r-h,4))}}zj(){this.hc("pointermove",this.kf);this.kf=null}ld(l,q){for(let h=0,r=q.changedTouches.length;h<r;++h){const t=q.changedTouches[h];I(this,l,{pointerId:t.identifier,
pointerType:"touch",button:0,buttons:0,lastButtons:0,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY,width:2*(t.radiusX||t.webkitRadiusX||0),height:2*(t.radiusY||t.webkitRadiusY||0),pressure:t.force||t.webkitForce||0,tangentialPressure:0,tiltX:0,tiltY:0,twist:t.rotationAngle||0,timeStamp:q.timeStamp},e)}}Be(l){window!==window.top&&window.focus();this.og(l.target)&&document.activeElement&&!this.og(document.activeElement)&&document.activeElement.blur()}og(l){return!l||l===document||
l===window||l===document.body||"canvas"===l.tagName.toLowerCase()}nj(){this.zg||(this.zg=!0,window.addEventListener("deviceorientation",l=>this.Yj(l)),window.addEventListener("deviceorientationabsolute",l=>this.Zj(l)))}mj(){this.yg||(this.yg=!0,window.addEventListener("devicemotion",l=>this.Xj(l)))}Yj(l){y(this,"deviceorientation",{absolute:!!l.absolute,alpha:l.alpha||0,beta:l.beta||0,gamma:l.gamma||0,timeStamp:l.timeStamp,webkitCompassHeading:l.webkitCompassHeading,webkitCompassAccuracy:l.webkitCompassAccuracy},
e)}Zj(l){y(this,"deviceorientationabsolute",{absolute:!!l.absolute,alpha:l.alpha||0,beta:l.beta||0,gamma:l.gamma||0,timeStamp:l.timeStamp},e)}Xj(l){let q=null;var h=l.acceleration;h&&(q={x:h.x||0,y:h.y||0,z:h.z||0});h=null;var r=l.accelerationIncludingGravity;r&&(h={x:r.x||0,y:r.y||0,z:r.z||0});r=null;const t=l.rotationRate;t&&(r={alpha:t.alpha||0,beta:t.beta||0,gamma:t.gamma||0});y(this,"devicemotion",{acceleration:q,accelerationIncludingGravity:h,rotationRate:r,interval:l.interval,timeStamp:l.timeStamp},
e)}Sk(l){const q=this.K.U;q.style.width=l.styleWidth+"px";q.style.height=l.styleHeight+"px";q.style.marginLeft=l.marginLeft+"px";q.style.marginTop=l.marginTop+"px";this.Kg&&(q.style.display="",this.Kg=!1)}hk(l){const q=l.url;l=l.filename;const h=document.createElement("a"),r=document.body;h.textContent=l;h.href=q;h.download=l;r.appendChild(h);h.click();r.removeChild(h)}async uk(l){var q=l.imageBitmapOpts;l=await self.C3_RasterSvgImageBlob(l.blob,l.imageWidth,l.imageHeight,l.surfaceWidth,l.surfaceHeight);
q=q?await createImageBitmap(l,q):await createImageBitmap(l);return{imageBitmap:q,transferables:[q]}}async ck(l){return await self.C3_GetSvgImageSize(l.blob)}async Pj(l){await n(l.url)}Pe(){var l=[...this.Pb];this.Pb.clear();if(!this.jb)for(const q of l)(l=q.play())&&l.catch(()=>{this.Jd.has(q)||this.Pb.add(q)})}qb(l){if("function"!==typeof l.play)throw Error("missing play function");this.Jd.delete(l);let q;try{q=l.play()}catch(h){this.Pb.add(l);return}q&&q.catch(()=>{this.Jd.has(l)||this.Pb.add(l)})}Ib(l){this.Pb.delete(l);
this.Jd.add(l)}fd(l){this.jb=!!l}dk(){navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide()}Wj(l){if(l.show){this.zb||(this.zb=document.createElement("div"),this.zb.id="inspectOutline",document.body.appendChild(this.zb));var q=this.zb;q.style.display="";q.style.left=l.left-1+"px";q.style.top=l.top-1+"px";q.style.width=l.width+2+"px";q.style.height=l.height+2+"px";q.textContent=l.name}else this.zb&&(this.zb.style.display="none")}wk(){window.C3_RegisterSW&&window.C3_RegisterSW()}tg(l){window.c3_postToMessagePort&&
(l.from="runtime",window.c3_postToMessagePort(l))}Lj(l,q){return A(this,"js-invoke-function",{name:l,params:q})}Ge(l){alert(l.message)}Uk(l){"entered-fullscreen"===l?(g.od(!0),this.fc()):"exited-fullscreen"===l?(g.od(!1),this.fc()):console.warn("Unknown wrapper message: ",l)}})}"use strict";
async function R(g){if(g.Gl)throw Error("already initialised");g.Gl=!0;var a=g.Nd.Ae("dispatchworker.js");g.Xe=await g.Nd.ae(a,g.Y,{name:"DispatchWorker"});a=new MessageChannel;g.ff=a.port1;g.Xe.postMessage({type:"_init","in-port":a.port2},[a.port2]);g.tf=await T(g)}function S(g){return[g.ff,g.tf]}
async function T(g){const a=g.Lg.length;var b=g.Nd.Ae("jobworker.js");b=await g.Nd.ae(b,g.Y,{name:"JobWorker"+a});const e=new MessageChannel,k=new MessageChannel;g.Xe.postMessage({type:"_addJobWorker",port:e.port1},[e.port1]);b.postMessage({type:"init",number:a,"dispatch-port":e.port2,"output-port":k.port2},[e.port2,k.port2]);g.Lg.push(b);return k.port1}
self.ri=class{constructor(g){this.Nd=g;this.Y=g.Y;this.Y="preview"===g.J?this.Y+"c3/workers/":this.Y+g.Od;this.Nl=Math.min(navigator.hardwareConcurrency||2,16);this.Xe=null;this.Lg=[];this.tf=this.ff=null}};"use strict";window.C3_IsSupported&&(window.c3_runtimeInterface=new self.ra({bm:!1,cm:"workermain.js",Yb:["scripts/c3runtime.js"],mh:[],hh:"",Zl:"scripts/",Ff:[],eh:"html5"}));"use strict";
{const g=180/Math.PI;self.Ua=class extends self.Ia{constructor(a){super(a,"audio");this.xd=this.o=null;this.Bd=this.cf=!1;this.mb=()=>this.Cl();this.Oa=[];this.X=[];this.Xa=null;this.Ng="";this.Qg=-1;this.Jc=new Map;this.nf=1;this.jb=!1;this.Bf=0;this.Sd=1;this.$e=0;this.Ug="HRTF";this.Gg="inverse";this.Wg=600;this.Tg=1E4;this.Yg=1;this.Ig=this.uf=!1;this.ah=this.K.oi();this.Pa=new Map;this.Kb=new Set;this.gf=!1;this.pf="";this.Cb=null;self.C3Audio_OnMicrophoneStream=(b,e)=>this.lk(b,e);this.wd=null;
self.C3Audio_GetOutputStream=()=>this.ak();self.C3Audio_DOMInterface=this;K(this,[["create-audio-context",b=>this.uj(b)],["play",b=>this.Wk(b)],["stop",b=>this.zl(b)],["stop-all",()=>this.Al()],["set-paused",b=>this.sl(b)],["set-volume",b=>this.xl(b)],["fade-volume",b=>this.Aj(b)],["set-master-volume",b=>this.ql(b)],["set-muted",b=>this.rl(b)],["set-silent",b=>this.ul(b)],["set-looping",b=>this.pl(b)],["set-playback-rate",b=>this.tl(b)],["seek",b=>this.dl(b)],["preload",b=>this.Xk(b)],["unload",b=>
this.Dl(b)],["unload-all",()=>this.El()],["set-suspended",b=>this.vl(b)],["add-effect",b=>this.fg(b)],["set-effect-param",b=>this.jl(b)],["remove-effects",b=>this.Zk(b)],["tick",b=>this.Rk(b)],["load-state",b=>this.ik(b)]])}async uj(a){a.isiOSCordova&&(this.uf=!0);this.Bf=a.timeScaleMode;this.Ug=["equalpower","HRTF","soundfield"][a.panningModel];this.Gg=["linear","inverse","exponential"][a.distanceModel];this.Wg=a.refDistance;this.Tg=a.maxDistance;this.Yg=a.rolloffFactor;var b={latencyHint:a.latencyHint};
this.ah||(b.sampleRate=48E3);if("undefined"!==typeof AudioContext)this.o=new AudioContext(b);else if("undefined"!==typeof webkitAudioContext)this.o=new webkitAudioContext(b);else throw Error("Web Audio API not supported");this.gg();this.o.onstatechange=()=>{"running"!==this.o.state&&this.gg()};this.xd=this.o.createGain();this.xd.connect(this.o.destination);b=a.listenerPos;this.o.listener.setPosition(b[0],b[1],b[2]);this.o.listener.setOrientation(0,0,1,0,-1,0);self.C3_GetAudioContextCurrentTime=()=>
this.be();try{await Promise.all(a.preloadList.map(e=>this.jd(e.originalUrl,e.url,e.type,!1)))}catch(e){console.error("[Construct 3] Preloading sounds failed: ",e)}return{sampleRate:this.o.sampleRate}}gg(){this.Bd||(this.cf=!1,window.addEventListener("pointerup",this.mb,!0),window.addEventListener("touchend",this.mb,!0),window.addEventListener("click",this.mb,!0),window.addEventListener("keydown",this.mb,!0),this.Bd=!0)}wj(){this.Bd&&(this.cf=!0,window.removeEventListener("pointerup",this.mb,!0),window.removeEventListener("touchend",
this.mb,!0),window.removeEventListener("click",this.mb,!0),window.removeEventListener("keydown",this.mb,!0),this.Bd=!1)}Cl(){if(!this.cf){var a=this.o;"suspended"===a.state&&a.resume&&a.resume();var b=a.createBuffer(1,220,22050),e=a.createBufferSource();e.buffer=b;e.connect(a.destination);e.start(0);"running"===a.state&&this.wj()}}wa(){return this.o}be(){return this.o.currentTime}ob(){return this.xd}Rf(a){return(a=this.Pa.get(a.toLowerCase()))?a[0].ka():this.ob()}ph(a,b){a=a.toLowerCase();let e=this.Pa.get(a);
e||(e=[],this.Pa.set(a,e));b.ml(e.length);b.wl(a);e.push(b);this.wg(a)}wg(a){let b=this.ob();const e=this.Pa.get(a);if(e&&e.length){b=e[0].ka();for(let k=0,u=e.length;k<u;++k){const n=e[k];k+1===u?n.pa(this.ob()):n.pa(e[k+1].ka())}}for(const k of this.eb(a))k.Ii(b);this.Cb&&this.pf===a&&(this.Cb.disconnect(),this.Cb.connect(b))}Xc(){return this.nf}bd(){return this.jb}kl(){this.Ig=!0}Qh(a,b){return b?this.K.Fl(a).then(e=>{const k=this.o.createBuffer(1,e.length,48E3);k.getChannelData(0).set(e);return k}):
new Promise((e,k)=>{this.o.decodeAudioData(a,e,k)})}qb(a){this.K.qb(a)}Ib(a){this.K.Ib(a)}Yf(a){let b=0;for(let e=0,k=this.X.length;e<k;++e){const u=this.X[e];this.X[b]=u;u.ga===a?u.l():++b}this.X.length=b}Ji(){let a=0;for(let b=0,e=this.Oa.length;b<e;++b){const k=this.Oa[b];this.Oa[a]=k;k.pb()?k.l():++a}this.Oa.length=a}*eb(a){if(a)for(const b of this.X)self.Ua.Rh(b.ba,a)&&(yield b);else this.Xa&&!this.Xa.qa()&&(yield this.Xa)}async jd(a,b,e,k,u){for(const n of this.Oa)if(n.$b()===b)return await U(n),
n;if(u)return null;k&&(this.uf||this.Ig)&&this.Ji();u="audio/webm; codecs=opus"===e&&!this.ah;k&&u&&this.kl();a=!k||this.uf||u?new self.Kh(this,a,b,e,k,u):new self.Fh(this,a,b,e,k);this.Oa.push(a);await U(a);return a}async ze(a,b,e,k,u){for(const n of this.X)if(n.$b()===b&&(n.$d()||u))return n.Ti(k),n;a=await this.jd(a,b,e,u);k="html5"===a.Se?new self.Gh(a.A,a,k):new self.Lh(a.A,a,k);this.X.push(k);return k}kj(a){let b=this.Jc.get(a);if(!b){let e=null;b={Ef:0,promise:new Promise(k=>e=k),resolve:e};
this.Jc.set(a,b)}b.Ef++}al(a){const b=this.Jc.get(a);if(!b)throw Error("expected pending tag");b.Ef--;0===b.Ef&&(b.resolve(),this.Jc.delete(a))}te(a){a||(a=this.Ng);return(a=this.Jc.get(a))?a.promise:Promise.resolve()}kd(){if(0<this.Kb.size)L(this);else for(const a of this.X)if(a.Tf()){L(this);break}}la(){for(var a of this.Kb)a.la();a=this.be();for(var b of this.X)b.la(a);b=this.X.filter(e=>e.Tf()).map(e=>e.Zb());y(this,"state",{tickCount:this.Qg,audioInstances:b,analysers:[...this.Kb].map(e=>e.Zh())});
0===b.length&&0===this.Kb.size&&this.Cd&&(this.K.bl(this.bh),this.Cd=!1)}ke(a,b,e){y(this,"trigger",{type:a,tag:b,aiid:e})}async Wk(a){const b=a.originalUrl,e=a.url,k=a.type,u=a.isMusic,n=a.tag,f=a.isLooping,m=a.vol,c=a.pos,d=a.panning;let p=a.off;0<p&&!a.trueClock&&(this.o.getOutputTimestamp?(a=this.o.getOutputTimestamp(),p=p-a.performanceTime/1E3+a.contextTime):p=p-performance.now()/1E3+this.o.currentTime);this.Ng=n;this.kj(n);try{this.Xa=await this.ze(b,e,k,n,u),d?(this.Xa.ed(!0),this.Xa.Ri(d.x,
d.y,d.angle,d.innerAngle,d.outerAngle,d.outerGain),d.hasOwnProperty("uid")&&this.Xa.Ui(d.uid)):this.Xa.ed(!1),this.Xa.Play(f,m,c,p)}catch(v){console.error("[Construct 3] Audio: error starting playback: ",v);return}finally{this.al(n)}L(this)}zl(a){a=a.tag;for(const b of this.eb(a))b.ib()}Al(){for(const a of this.X)a.ib()}sl(a){const b=a.tag;a=a.paused;for(const e of this.eb(b))a?e.dc():e.dd();this.kd()}xl(a){const b=a.tag;a=a.vol;for(const e of this.eb(b))e.gd(a)}async Aj(a){const b=a.tag,e=a.vol,
k=a.duration;a=a.stopOnEnd;await this.te(b);for(const u of this.eb(b))u.Sh(e,k,a);this.kd()}ql(a){this.nf=a.vol;for(const b of this.X)b.qd()}rl(a){const b=a.tag;a=a.isMuted;for(const e of this.eb(b))e.ag(a)}ul(a){this.jb=a.isSilent;this.K.fd(this.jb);for(const b of this.X)b.pd()}pl(a){const b=a.tag;a=a.isLooping;for(const e of this.eb(b))e.qe(a)}async tl(a){const b=a.tag;a=a.rate;await this.te(b);for(const e of this.eb(b))e.cg(a)}async dl(a){const b=a.tag;a=a.pos;await this.te(b);for(const e of this.eb(b))e.oe(a)}async Xk(a){const b=
a.originalUrl,e=a.url,k=a.type;a=a.isMusic;try{await this.ze(b,e,k,"",a)}catch(u){console.error("[Construct 3] Audio: error preloading: ",u)}}async Dl(a){if(a=await this.jd("",a.url,a.type,a.isMusic,!0))a.l(),a=this.Oa.indexOf(a),-1!==a&&this.Oa.splice(a,1)}El(){for(const a of this.Oa)a.l();this.Oa.length=0}vl(a){a=a.isSuspended;!a&&this.o.resume&&this.o.resume();for(const b of this.X)b.re(a);a&&this.o.suspend&&this.o.suspend()}Rk(a){this.Sd=a.timeScale;this.$e=a.gameTime;this.Qg=a.tickCount;if(0!==
this.Bf)for(var b of this.X)b.Jb();(b=a.listenerPos)&&this.o.listener.setPosition(b[0],b[1],b[2]);for(const e of a.instPans){a=e.uid;for(const k of this.X)k.Wa===a&&k.bg(e.x,e.y,e.angle)}}async fg(a){var b=a.type;const e=a.tag;var k=a.params;if("filter"===b)k=new self.zh(this,...k);else if("delay"===b)k=new self.xh(this,...k);else if("convolution"===b){b=null;try{b=await this.jd(a.bufferOriginalUrl,a.bufferUrl,a.bufferType,!1)}catch(u){console.log("[Construct 3] Audio: error loading convolution: ",
u);return}k=new self.wh(this,b.Na,...k);k.hl(a.bufferOriginalUrl,a.bufferType)}else if("flanger"===b)k=new self.Ah(this,...k);else if("phaser"===b)k=new self.Ch(this,...k);else if("gain"===b)k=new self.Bh(this,...k);else if("tremolo"===b)k=new self.Eh(this,...k);else if("ringmod"===b)k=new self.Dh(this,...k);else if("distortion"===b)k=new self.yh(this,...k);else if("compressor"===b)k=new self.vh(this,...k);else if("analyser"===b)k=new self.uh(this,...k);else throw Error("invalid effect type");this.ph(e,
k);this.vg()}jl(a){const b=a.index,e=a.param,k=a.value,u=a.ramp,n=a.time;a=this.Pa.get(a.tag);!a||0>b||b>=a.length||(a[b].za(e,k,u,n),this.vg())}Zk(a){a=a.tag.toLowerCase();const b=this.Pa.get(a);if(b&&b.length){for(const e of b)e.l();this.Pa.delete(a);this.wg(a)}}gj(a){this.Kb.add(a);this.kd()}Yk(a){this.Kb.delete(a)}vg(){this.gf||(this.gf=!0,Promise.resolve().then(()=>this.yj()))}yj(){const a={};for(const [b,e]of this.Pa)a[b]=e.map(k=>k.Zb());y(this,"fxstate",{fxstate:a});this.gf=!1}async ik(a){const b=
a.saveLoadMode;if(3!==b)for(var e of this.X)e.pb()&&1===b||(e.pb()||2!==b)&&e.ib();for(const k of this.Pa.values())for(const u of k)u.l();this.Pa.clear();this.Sd=a.timeScale;this.$e=a.gameTime;e=a.listenerPos;this.o.listener.setPosition(e[0],e[1],e[2]);this.jb=a.isSilent;this.K.fd(this.jb);this.nf=a.masterVolume;e=[];for(const k of Object.values(a.effects))e.push(Promise.all(k.map(u=>this.fg(u))));await Promise.all(e);await Promise.all(a.playing.map(k=>this.Mj(k,b)));this.kd()}async Mj(a,b){if(3!==
b){var e=a.bufferOriginalUrl,k=a.bufferUrl,u=a.bufferType,n=a.isMusic,f=a.tag,m=a.isLooping,c=a.volume,d=a.playbackTime;if(!n||1!==b)if(n||2!==b){b=null;try{b=await this.ze(e,k,u,f,n)}catch(p){console.error("[Construct 3] Audio: error loading audio state: ",p);return}b.vi(a.pan);b.Play(m,c,d,0);a.isPlaying||b.dc();b.De(a)}}}lk(a,b){this.Cb&&this.Cb.disconnect();this.pf=b.toLowerCase();this.Cb=this.o.createMediaStreamSource(a);this.Cb.connect(this.Rf(this.pf))}ak(){this.wd||(this.wd=this.o.createMediaStreamDestination(),
this.xd.connect(this.wd));return this.wd.stream}static Rh(a,b){return a.length!==b.length?!1:a===b?!0:a.toLowerCase()===b.toLowerCase()}static fj(a){return a*g}static Ph(a){return Math.pow(10,a/20)}static Pf(a){return Math.max(Math.min(self.Ua.Ph(a),1),0)}static ti(a){return Math.log(a)/Math.log(10)*20}static si(a){return self.Ua.ti(Math.max(Math.min(a,1),0))}static Vl(a,b){return 1-Math.exp(-b*a)}};self.ra.Ha(self.Ua)}"use strict";function U(g){g.Hd||(g.Hd=g.Ce());return g.Hd}
self.If=class{constructor(g,a,b,e,k){this.A=g;this.Ql=a;this.Fb=b;this.oa=e;this.Jl=k;this.Se="";this.Hd=null}l(){this.Hd=this.A=null}Ce(){}wa(){return this.A.wa()}de(){return this.Ql}$b(){return this.Fb}ce(){return this.oa}pb(){return this.Jl}Va(){}};"use strict";
self.Fh=class extends self.If{constructor(g,a,b,e,k){super(g,a,b,e,k);this.Se="html5";this.da=new Audio;this.da.crossOrigin="anonymous";this.da.autoplay=!1;this.da.preload="auto";this.zc=this.Ac=null;this.da.addEventListener("canplaythrough",()=>!0);this.Hc=this.wa().createGain();this.Cc=null;this.da.addEventListener("canplay",()=>{this.Ac&&(this.Ac(),this.zc=this.Ac=null);!this.Cc&&this.da&&(this.Cc=this.wa().createMediaElementSource(this.da),this.Cc.connect(this.Hc))});this.onended=null;this.da.addEventListener("ended",
()=>{if(this.onended)this.onended()});this.da.addEventListener("error",u=>{console.error(`[Construct 3] Audio '${this.Fb}' error: `,u);this.zc&&(this.zc(u),this.zc=this.Ac=null)})}l(){this.A.Yf(this);this.Hc.disconnect();this.Hc=null;this.Cc.disconnect();this.Cc=null;this.da&&!this.da.paused&&this.da.pause();this.da=this.onended=null;super.l()}Ce(){return new Promise((g,a)=>{this.Ac=g;this.zc=a;this.da.src=this.Fb})}ja(){return this.da}Va(){return this.da.duration}};"use strict";
async function ba(g){if(g.vb)return g.vb;var a=g.A.K;if("cordova"===a.J&&a.Vf(g.Fb)&&"file:"===location.protocol)g.vb=await a.Vc(g.Fb);else{a=await fetch(g.Fb);if(!a.ok)throw Error(`error fetching audio data: ${a.status} ${a.statusText}`);g.vb=await a.arrayBuffer()}}async function ca(g){if(g.Na)return g.Na;g.Na=await g.A.Qh(g.vb,g.Ol);g.vb=null}
self.Kh=class extends self.If{constructor(g,a,b,e,k,u){super(g,a,b,e,k);this.Se="webaudio";this.Na=this.vb=null;this.Ol=!!u}l(){this.A.Yf(this);this.Na=this.vb=null;super.l()}async Ce(){try{await ba(this),await ca(this)}catch(g){console.error(`[Construct 3] Failed to load audio '${this.Fb}': `,g)}}Va(){return this.Na?this.Na.duration:0}};"use strict";
{let g=0;self.Jf=class{constructor(a,b,e){this.A=a;this.ga=b;this.ba=e;this.rd=g++;this.ha=this.wa().createGain();this.ha.connect(this.ob());this.O=null;this.uc=!1;this.$a=[0,0,0];this.Za=[0,0,0];this.$=!0;this.ta=this.bb=this.Z=!1;this.Qc=1;this.Nb=!1;this.Fa=1;a=this.A.Bf;this.hf=1===a&&!this.pb()||2===a;this.nc=this.Wa=-1;this.$g=!1}l(){this.ga=this.A=null;this.O&&(this.O.disconnect(),this.O=null);this.ha.disconnect();this.ha=null}wa(){return this.A.wa()}ob(){return this.A.Rf(this.ba)}Xc(){return this.A.Xc()}Wc(){return this.hf?
this.A.$e:performance.now()/1E3}de(){return this.ga.de()}$b(){return this.ga.$b()}ce(){return this.ga.ce()}pb(){return this.ga.pb()}Ti(a){this.ba=a}qa(){}$d(){}IsPlaying(){return!this.$&&!this.Z&&!this.qa()}Tf(){return!this.$&&!this.qa()}Gb(){}Va(){return this.ga.Va()}Play(){}ib(){}dc(){}dd(){}gd(a){this.Qc=a;this.ha.gain.cancelScheduledValues(0);this.nc=-1;this.ha.gain.value=this.ee()}Sh(a,b,e){if(!this.Nb){a*=this.Xc();var k=this.ha.gain;k.cancelScheduledValues(0);var u=this.A.be();b=u+b;k.setValueAtTime(k.value,
u);k.linearRampToValueAtTime(a,b);this.Qc=a;this.nc=b;this.$g=e}}qd(){this.gd(this.Qc)}la(a){-1!==this.nc&&a>=this.nc&&(this.nc=-1,this.$g&&this.ib(),this.A.ke("fade-ended",this.ba,this.rd))}ee(){const a=this.Qc*this.Xc();return isFinite(a)?a:0}ag(a){a=!!a;this.Nb!==a&&(this.Nb=a,this.pd())}bd(){return this.A.bd()}pd(){}qe(){}cg(a){this.Fa!==a&&(this.Fa=a,this.Jb())}Jb(){}oe(){}re(){}ed(a){a=!!a;this.uc!==a&&((this.uc=a)?(this.O||(this.O=this.wa().createPanner(),this.O.panningModel=this.A.Ug,this.O.distanceModel=
this.A.Gg,this.O.refDistance=this.A.Wg,this.O.maxDistance=this.A.Tg,this.O.rolloffFactor=this.A.Yg),this.ha.disconnect(),this.ha.connect(this.O),this.O.connect(this.ob())):(this.O.disconnect(),this.ha.disconnect(),this.ha.connect(this.ob())))}Ri(a,b,e,k,u,n){this.uc&&(this.bg(a,b,e),a=self.Ua.fj,this.O.coneInnerAngle=a(k),this.O.coneOuterAngle=a(u),this.O.coneOuterGain=n)}bg(a,b,e){this.uc&&(this.$a[0]=a,this.$a[1]=b,this.$a[2]=0,this.Za[0]=Math.cos(e),this.Za[1]=Math.sin(e),this.Za[2]=0,this.O.setPosition(...this.$a),
this.O.setOrientation(...this.Za))}Ui(a){this.Wa=a}fe(){}Ii(a){const b=this.O||this.ha;b.disconnect();b.connect(a)}Zb(){return{aiid:this.rd,tag:this.ba,duration:this.Va(),volume:this.Qc,isPlaying:this.IsPlaying(),playbackTime:this.Gb(),playbackRate:this.Fa,uid:this.Wa,bufferOriginalUrl:this.de(),bufferUrl:"",bufferType:this.ce(),isMusic:this.pb(),isLooping:this.ta,isMuted:this.Nb,resumePosition:this.fe(),pan:this.gi()}}De(a){this.cg(a.playbackRate);this.ag(a.isMuted)}gi(){if(!this.O)return null;const a=
this.O;return{pos:this.$a,orient:this.Za,cia:a.coneInnerAngle,coa:a.coneOuterAngle,cog:a.coneOuterGain,uid:this.Wa}}vi(a){if(a){this.ed(!0);a=this.O;var b=a.pos;this.$a[0]=b[0];this.$a[1]=b[1];this.$a[2]=b[2];b=a.orient;this.Za[0]=b[0];this.Za[1]=b[1];this.Za[2]=b[2];a.setPosition(...this.$a);a.setOrientation(...this.Za);a.coneInnerAngle=a.cia;a.coneOuterAngle=a.coa;a.coneOuterGain=a.cog;this.Wa=a.uid}else this.ed(!1)}}}"use strict";
self.Gh=class extends self.Jf{constructor(g,a,b){super(g,a,b);this.ga.Hc.connect(this.ha);this.ga.onended=()=>this.Ie()}l(){this.ib();this.ga.Hc.disconnect();super.l()}ja(){return this.ga.ja()}Ie(){this.$=!0;this.Wa=-1;this.A.ke("ended",this.ba,this.rd)}qa(){return this.ja().ended}$d(){return this.$?!0:this.qa()}Gb(g){let a=this.ja().currentTime;g&&(a*=this.Fa);this.ta||(a=Math.min(a,this.Va()));return a}Play(g,a,b){const e=this.ja();1!==e.playbackRate&&(e.playbackRate=1);e.loop!==g&&(e.loop=g);this.gd(a);
e.muted&&(e.muted=!1);if(e.currentTime!==b)try{e.currentTime=b}catch(k){console.warn(`[Construct 3] Exception seeking audio '${this.ga.$b()}' to position '${b}': `,k)}this.A.qb(e);this.Z=this.$=!1;this.ta=g;this.Fa=1}ib(){const g=this.ja();g.paused||g.pause();this.A.Ib(g);this.$=!0;this.Z=!1;this.Wa=-1}dc(){if(!(this.Z||this.$||this.qa())){var g=this.ja();g.paused||g.pause();this.A.Ib(g);this.Z=!0}}dd(){!this.Z||this.$||this.qa()||(this.A.qb(this.ja()),this.Z=!1)}pd(){this.ja().muted=this.Nb||this.bd()}qe(g){g=
!!g;this.ta!==g&&(this.ta=g,this.ja().loop=g)}Jb(){let g=this.Fa;this.hf&&(g*=this.A.Sd);try{this.ja().playbackRate=g}catch(a){console.warn(`[Construct 3] Unable to set playback rate '${g}':`,a)}}oe(g){if(!this.$&&!this.qa())try{this.ja().currentTime=g}catch(a){console.warn(`[Construct 3] Error seeking audio to '${g}': `,a)}}fe(){return this.Gb()}re(g){g?this.IsPlaying()?(this.ja().pause(),this.bb=!0):this.bb=!1:this.bb&&(this.A.qb(this.ja()),this.bb=!1)}};"use strict";
function V(g){g.B&&g.B.disconnect();g.B=null;g.jc=null}
self.Lh=class extends self.Jf{constructor(g,a,b){super(g,a,b);this.B=null;this.Kd=e=>this.Ie(e);this.bf=!0;this.jc=null;this.ia=this.Qd=0;this.qf=1}l(){this.ib();V(this);this.Kd=null;super.l()}Ie(g){this.Z||this.bb||g.target!==this.jc||(this.$=this.bf=!0,this.Wa=-1,V(this),this.A.ke("ended",this.ba,this.rd))}qa(){return!this.$&&this.B&&this.B.loop||this.Z?!1:this.bf}$d(){return!this.B||this.$?!0:this.qa()}Gb(g){let a;a=this.Z?this.ia:this.Wc()-this.Qd;g&&(a*=this.Fa);this.ta||(a=Math.min(a,this.Va()));
return a}Play(g,a,b,e){this.qf=1;this.gd(a);V(this);this.B=this.wa().createBufferSource();this.B.buffer=this.ga.Na;this.B.connect(this.ha);this.jc=this.B;this.B.onended=this.Kd;this.B.loop=g;this.B.start(e,b);this.Z=this.$=this.bf=!1;this.ta=g;this.Fa=1;this.Qd=this.Wc()-b}ib(){if(this.B)try{this.B.stop(0)}catch(g){}this.$=!0;this.Z=!1;this.Wa=-1}dc(){this.Z||this.$||this.qa()||(this.ia=this.Gb(!0),this.ta&&(this.ia%=this.Va()),this.Z=!0,this.B.stop(0))}dd(){!this.Z||this.$||this.qa()||(V(this),this.B=
this.wa().createBufferSource(),this.B.buffer=this.ga.Na,this.B.connect(this.ha),this.jc=this.B,this.B.onended=this.Kd,this.B.loop=this.ta,this.qd(),this.Jb(),this.Qd=this.Wc()-this.ia/(this.Fa||.001),this.B.start(0,this.ia),this.Z=!1)}ee(){return super.ee()*this.qf}pd(){this.qf=this.Nb||this.bd()?0:1;this.qd()}qe(g){g=!!g;this.ta!==g&&(this.ta=g,this.B&&(this.B.loop=g))}Jb(){let g=this.Fa;this.hf&&(g*=this.A.Sd);this.B&&(this.B.playbackRate.value=g)}oe(g){this.$||this.qa()||(this.Z?this.ia=g:(this.dc(),
this.ia=g,this.dd()))}fe(){return this.ia}re(g){g?this.IsPlaying()?(this.bb=!0,this.ia=this.Gb(!0),this.ta&&(this.ia%=this.Va()),this.B.stop(0)):this.bb=!1:this.bb&&(V(this),this.B=this.wa().createBufferSource(),this.B.buffer=this.ga.Na,this.B.connect(this.ha),this.jc=this.B,this.B.onended=this.Kd,this.B.loop=this.ta,this.qd(),this.Jb(),this.Qd=this.Wc()-this.ia/(this.Fa||.001),this.B.start(0,this.ia),this.bb=!1)}De(g){super.De(g);this.ia=g.resumePosition}};"use strict";
{class g{constructor(a){this.A=a;this.o=a.wa();this.rc=-1;this.oa=this.ba="";this.s=null}l(){this.o=null}ml(a){this.rc=a}wl(a){this.ba=a}G(){return this.o.createGain()}ka(){}pa(){}F(a,b,e,k){a.cancelScheduledValues(0);if(0===k)a.value=b;else{var u=this.o.currentTime;k+=u;switch(e){case 0:a.setValueAtTime(b,k);break;case 1:a.setValueAtTime(a.value,u);a.linearRampToValueAtTime(b,k);break;case 2:a.setValueAtTime(a.value,u),a.exponentialRampToValueAtTime(b,k)}}}Zb(){return{type:this.oa,tag:this.ba,params:this.s}}}
self.zh=class extends g{constructor(a,b,e,k,u,n,f){super(a);this.oa="filter";this.s=[b,e,k,u,n,f];this.D=this.G();this.h=this.G();this.h.gain.value=f;this.g=this.G();this.g.gain.value=1-f;this.M=this.o.createBiquadFilter();this.M.type=b;this.M.frequency.value=e;this.M.detune.value=k;this.M.Q.value=u;this.M.gain.vlaue=n;this.D.connect(this.M);this.D.connect(this.g);this.M.connect(this.h)}l(){this.D.disconnect();this.M.disconnect();this.h.disconnect();this.g.disconnect();super.l()}pa(a){this.h.disconnect();
this.h.connect(a);this.g.disconnect();this.g.connect(a)}ka(){return this.D}za(a,b,e,k){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this.s[5]=b;this.F(this.h.gain,b,e,k);this.F(this.g.gain,1-b,e,k);break;case 1:this.s[1]=b;this.F(this.M.frequency,b,e,k);break;case 2:this.s[2]=b;this.F(this.M.detune,b,e,k);break;case 3:this.s[3]=b;this.F(this.M.Q,b,e,k);break;case 4:this.s[4]=b,this.F(this.M.gain,b,e,k)}}};self.xh=class extends g{constructor(a,b,e,k){super(a);this.oa="delay";this.s=[b,e,k];this.D=
this.G();this.h=this.G();this.h.gain.value=k;this.g=this.G();this.g.gain.value=1-k;this.Bc=this.G();this.sa=this.o.createDelay(b);this.sa.delayTime.value=b;this.mc=this.G();this.mc.gain.value=e;this.D.connect(this.Bc);this.D.connect(this.g);this.Bc.connect(this.h);this.Bc.connect(this.sa);this.sa.connect(this.mc);this.mc.connect(this.Bc)}l(){this.D.disconnect();this.h.disconnect();this.g.disconnect();this.Bc.disconnect();this.sa.disconnect();this.mc.disconnect();super.l()}pa(a){this.h.disconnect();
this.h.connect(a);this.g.disconnect();this.g.connect(a)}ka(){return this.D}za(a,b,e,k){const u=self.Ua.Pf;switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this.s[2]=b;this.F(this.h.gain,b,e,k);this.F(this.g.gain,1-b,e,k);break;case 4:this.s[1]=u(b);this.F(this.mc.gain,u(b),e,k);break;case 5:this.s[0]=b,this.F(this.sa.delayTime,b,e,k)}}};self.wh=class extends g{constructor(a,b,e,k){super(a);this.oa="convolution";this.s=[e,k];this.Cg=this.Bg="";this.D=this.G();this.h=this.G();this.h.gain.value=k;this.g=
this.G();this.g.gain.value=1-k;this.lc=this.o.createConvolver();this.lc.normalize=e;this.lc.buffer=b;this.D.connect(this.lc);this.D.connect(this.g);this.lc.connect(this.h)}l(){this.D.disconnect();this.lc.disconnect();this.h.disconnect();this.g.disconnect();super.l()}pa(a){this.h.disconnect();this.h.connect(a);this.g.disconnect();this.g.connect(a)}ka(){return this.D}za(a,b,e,k){switch(a){case 0:b=Math.max(Math.min(b/100,1),0),this.s[1]=b,this.F(this.h.gain,b,e,k),this.F(this.g.gain,1-b,e,k)}}hl(a,
b){this.Bg=a;this.Cg=b}Zb(){const a=super.Zb();a.bufferOriginalUrl=this.Bg;a.bufferUrl="";a.bufferType=this.Cg;return a}};self.Ah=class extends g{constructor(a,b,e,k,u,n){super(a);this.oa="flanger";this.s=[b,e,k,u,n];this.D=this.G();this.g=this.G();this.g.gain.value=1-n/2;this.h=this.G();this.h.gain.value=n/2;this.oc=this.G();this.oc.gain.value=u;this.sa=this.o.createDelay(b+e);this.sa.delayTime.value=b;this.I=this.o.createOscillator();this.I.frequency.value=k;this.aa=this.G();this.aa.gain.value=
e;this.D.connect(this.sa);this.D.connect(this.g);this.sa.connect(this.h);this.sa.connect(this.oc);this.oc.connect(this.sa);this.I.connect(this.aa);this.aa.connect(this.sa.delayTime);this.I.start(0)}l(){this.I.stop(0);this.D.disconnect();this.sa.disconnect();this.I.disconnect();this.aa.disconnect();this.g.disconnect();this.h.disconnect();this.oc.disconnect();super.l()}pa(a){this.h.disconnect();this.h.connect(a);this.g.disconnect();this.g.connect(a)}ka(){return this.D}za(a,b,e,k){switch(a){case 0:b=
Math.max(Math.min(b/100,1),0);this.s[4]=b;this.F(this.h.gain,b/2,e,k);this.F(this.g.gain,1-b/2,e,k);break;case 6:this.s[1]=b/1E3;this.F(this.aa.gain,b/1E3,e,k);break;case 7:this.s[2]=b;this.F(this.I.frequency,b,e,k);break;case 8:this.s[3]=b/100,this.F(this.oc.gain,b/100,e,k)}}};self.Ch=class extends g{constructor(a,b,e,k,u,n,f){super(a);this.oa="phaser";this.s=[b,e,k,u,n,f];this.D=this.G();this.g=this.G();this.g.gain.value=1-f/2;this.h=this.G();this.h.gain.value=f/2;this.M=this.o.createBiquadFilter();
this.M.type="allpass";this.M.frequency.value=b;this.M.detune.value=e;this.M.Q.value=k;this.I=this.o.createOscillator();this.I.frequency.value=n;this.aa=this.G();this.aa.gain.value=u;this.D.connect(this.M);this.D.connect(this.g);this.M.connect(this.h);this.I.connect(this.aa);this.aa.connect(this.M.frequency);this.I.start(0)}l(){this.I.stop(0);this.D.disconnect();this.M.disconnect();this.I.disconnect();this.aa.disconnect();this.g.disconnect();this.h.disconnect();super.l()}pa(a){this.h.disconnect();
this.h.connect(a);this.g.disconnect();this.g.connect(a)}ka(){return this.D}za(a,b,e,k){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this.s[5]=b;this.F(this.h.gain,b/2,e,k);this.F(this.g.gain,1-b/2,e,k);break;case 1:this.s[0]=b;this.F(this.M.frequency,b,e,k);break;case 2:this.s[1]=b;this.F(this.M.detune,b,e,k);break;case 3:this.s[2]=b;this.F(this.M.Q,b,e,k);break;case 6:this.s[3]=b;this.F(this.aa.gain,b,e,k);break;case 7:this.s[4]=b,this.F(this.I.frequency,b,e,k)}}};self.Bh=class extends g{constructor(a,
b){super(a);this.oa="gain";this.s=[b];this.v=this.G();this.v.gain.value=b}l(){this.v.disconnect();super.l()}pa(a){this.v.disconnect();this.v.connect(a)}ka(){return this.v}za(a,b,e,k){const u=self.Ua.Pf;switch(a){case 4:this.s[0]=u(b),this.F(this.v.gain,u(b),e,k)}}};self.Eh=class extends g{constructor(a,b,e){super(a);this.oa="tremolo";this.s=[b,e];this.v=this.G();this.v.gain.value=1-e/2;this.I=this.o.createOscillator();this.I.frequency.value=b;this.aa=this.G();this.aa.gain.value=e/2;this.I.connect(this.aa);
this.aa.connect(this.v.gain);this.I.start(0)}l(){this.I.stop(0);this.I.disconnect();this.aa.disconnect();this.v.disconnect();super.l()}pa(a){this.v.disconnect();this.v.connect(a)}ka(){return this.v}za(a,b,e,k){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this.s[1]=b;this.F(this.v.gain,1-b/2,e,k);this.F(this.aa.gain,b/2,e,k);break;case 7:this.s[0]=b,this.F(this.I.frequency,b,e,k)}}};self.Dh=class extends g{constructor(a,b,e){super(a);this.oa="ringmod";this.s=[b,e];this.D=this.G();this.h=this.G();
this.h.gain.value=e;this.g=this.G();this.g.gain.value=1-e;this.Nc=this.G();this.Nc.gain.value=0;this.I=this.o.createOscillator();this.I.frequency.value=b;this.I.connect(this.Nc.gain);this.I.start(0);this.D.connect(this.Nc);this.D.connect(this.g);this.Nc.connect(this.h)}l(){this.I.stop(0);this.I.disconnect();this.Nc.disconnect();this.D.disconnect();this.h.disconnect();this.g.disconnect();super.l()}pa(a){this.h.disconnect();this.h.connect(a);this.g.disconnect();this.g.connect(a)}ka(){return this.D}za(a,
b,e,k){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this.s[1]=b;this.F(this.h.gain,b,e,k);this.F(this.g.gain,1-b,e,k);break;case 7:this.s[0]=b,this.F(this.I.frequency,b,e,k)}}};self.yh=class extends g{constructor(a,b,e,k,u,n){super(a);this.oa="distortion";this.s=[b,e,k,u,n];this.D=this.G();this.Md=this.G();this.Ld=this.G();this.il(k,u);this.h=this.G();this.h.gain.value=n;this.g=this.G();this.g.gain.value=1-n;this.Wd=this.o.createWaveShaper();this.Ve=new Float32Array(65536);this.Cj(b,e);this.Wd.curve=
this.Ve;this.D.connect(this.Md);this.D.connect(this.g);this.Md.connect(this.Wd);this.Wd.connect(this.Ld);this.Ld.connect(this.h)}l(){this.D.disconnect();this.Md.disconnect();this.Wd.disconnect();this.Ld.disconnect();this.h.disconnect();this.g.disconnect();super.l()}il(a,b){.01>a&&(a=.01);this.Md.gain.value=a;this.Ld.gain.value=Math.pow(1/a,.6)*b}Cj(a,b){for(let e=0;32768>e;++e){let k=e/32768;k=this.yl(k,a,b);this.Ve[32768+e]=k;this.Ve[32768-e-1]=-k}}yl(a,b,e){e=1.05*e*b-b;const k=0>a?-a:a;return(k<
b?k:b+e*self.Ua.Vl(k-b,1/e))*(0>a?-1:1)}pa(a){this.h.disconnect();this.h.connect(a);this.g.disconnect();this.g.connect(a)}ka(){return this.D}za(a,b,e,k){switch(a){case 0:b=Math.max(Math.min(b/100,1),0),this.s[4]=b,this.F(this.h.gain,b,e,k),this.F(this.g.gain,1-b,e,k)}}};self.vh=class extends g{constructor(a,b,e,k,u,n){super(a);this.oa="compressor";this.s=[b,e,k,u,n];this.v=this.o.createDynamicsCompressor();this.v.threshold.value=b;this.v.knee.value=e;this.v.ratio.value=k;this.v.attack.value=u;this.v.release.value=
n}l(){this.v.disconnect();super.l()}pa(a){this.v.disconnect();this.v.connect(a)}ka(){return this.v}za(){}};self.uh=class extends g{constructor(a,b,e){super(a);this.oa="analyser";this.s=[b,e];this.v=this.o.createAnalyser();this.v.fftSize=b;this.v.smoothingTimeConstant=e;this.Hg=new Float32Array(this.v.frequencyBinCount);this.Zg=new Uint8Array(b);this.Xg=this.Rb=0;this.A.gj(this)}l(){this.A.Yk(this);this.v.disconnect();super.l()}la(){this.v.getFloatFrequencyData(this.Hg);this.v.getByteTimeDomainData(this.Zg);
const a=this.v.fftSize;let b=this.Rb=0;for(var e=0;e<a;++e){let k=(this.Zg[e]-128)/128;0>k&&(k=-k);this.Rb<k&&(this.Rb=k);b+=k*k}e=self.Ua.si;this.Rb=e(this.Rb);this.Xg=e(Math.sqrt(b/a))}pa(a){this.v.disconnect();this.v.connect(a)}ka(){return this.v}za(){}Zh(){return{tag:this.ba,index:this.rc,peak:this.Rb,rms:this.Xg,binCount:this.v.frequencyBinCount,freqBins:this.Hg}}}}"use strict";
function da(g){window.C3_RegisterSW&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(a=>y(g,"sw-message",a.data))}
function ea(g){g=g.orientation;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(g).catch(a=>console.warn("[Construct 3] Failed to lock orientation: ",a));else try{let a=!1;screen.lockOrientation?a=screen.lockOrientation(g):screen.webkitLockOrientation?a=screen.webkitLockOrientation(g):screen.mozLockOrientation?a=screen.mozLockOrientation(g):screen.msLockOrientation&&(a=screen.msLockOrientation(g));a||console.warn("[Construct 3] Failed to lock orientation")}catch(a){console.warn("[Construct 3] Failed to lock orientation: ",
a)}}
self.ra.Ha(class extends self.Ia{constructor(g){super(g,"browser");this.J="";K(this,[["get-initial-state",a=>this.Ke(a)],["ready-for-sw-messages",()=>da(this)],["alert",a=>this.Ge(a)],["close",()=>this.He()],["set-focus",a=>this.Ne(a)],["vibrate",a=>{navigator.vibrate&&navigator.vibrate(a.pattern)}],["lock-orientation",a=>ea(a)],["unlock-orientation",()=>{try{screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():
screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()}catch(a){}}],["navigate",a=>{var b=a.type;if("back"===b)navigator.app&&navigator.app.backHistory?navigator.app.backHistory():window.history.back();else if("forward"===b)window.history.forward();else if("reload"===b)location.reload();else if("url"===b){b=a.url;var e=a.target;a=a.exportType;"windows-uwp"===a&&"undefined"!==typeof Windows?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(b)):
self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(b,"_system"):"preview"===a||"windows-webview2"===a?window.open(b,"_blank"):this.gm||(2===e?window.top.location=b:1===e?window.parent.location=b:window.location=b)}else"new-window"===b&&(b=a.url,e=a.tag,"windows-uwp"===a.exportType&&"undefined"!==typeof Windows?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(b)):self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(b,"_system"):window.open(b,e))}],
["request-fullscreen",a=>{if("windows-webview2"===this.J||"macos-wkwebview"===this.J)self.ra.od(!0),this.K.Re({type:"set-fullscreen",fullscreen:!0});else{const b={navigationUI:"auto"};a=a.navUI;1===a?b.navigationUI="hide":2===a&&(b.navigationUI="show");a=document.documentElement;a.requestFullscreen?a.requestFullscreen(b):a.mozRequestFullScreen?a.mozRequestFullScreen(b):a.msRequestFullscreen?a.msRequestFullscreen(b):a.webkitRequestFullScreen&&("undefined"!==typeof Element.ALLOW_KEYBOARD_INPUT?a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):
a.webkitRequestFullScreen())}}],["exit-fullscreen",()=>{"windows-webview2"===this.J||"macos-wkwebview"===this.J?(self.ra.od(!1),this.K.Re({type:"set-fullscreen",fullscreen:!1})):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}],["set-hash",a=>{location.hash=a.hash}]]);window.addEventListener("online",()=>{y(this,"online-state",
{isOnline:!0})});window.addEventListener("offline",()=>{y(this,"online-state",{isOnline:!1})});window.addEventListener("hashchange",()=>{y(this,"hashchange",{location:location.toString()})});document.addEventListener("backbutton",()=>{y(this,"backbutton")});"undefined"!==typeof Windows&&Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",a=>{a.handled=!0;y(this,"backbutton")})}Ke(g){this.J=g.exportType;return{location:location.toString(),isOnline:!!navigator.onLine,
referrer:document.referrer,title:document.title,isCookieEnabled:!!navigator.cookieEnabled,screenWidth:screen.width,screenHeight:screen.height,windowOuterWidth:window.outerWidth,windowOuterHeight:window.outerHeight,isScirraArcade:"undefined"!==typeof window.is_scirra_arcade}}Ge(g){alert(g.message)}He(){navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():window.close()}Ne(g){g=g.isFocus;if("nwjs"===this.J){const a="nwjs"===
this.J?nw.Window.get():null;g?a.focus():a.blur()}else g?window.focus():window.blur()}});"use strict";
{const g=[],a=2*Math.PI;function b(f){f%=a;0>f&&(f+=a);return f}class e{constructor(f,m,c,d,p,v){this.rc=f;this.sc=m;this.lb=c;this.ba=d;this.Vd=p;this.Eg=v}Hb(){return{tag:this.ba,interp:this.sc,userData:this.Vd,cvt:this.Eg}}gb(){return this.sc}li(){return"undefined"!==typeof this.Vd}Lf(f){switch(this.lb){case 0:return f;case 1:return Math.fround(f);case 2:return 2===this.sc&&(f=b(f),f/=Math.PI,f=32767*(f-1)),f|=0,-32768>f?-32768:32767<f?32767:f;case 3:return 2===this.sc&&(f=b(f),f/=a,f*=255),f|=
0,0>f?0:255<f?255:f;default:return f}}eg(f,m,c){switch(this.lb){case 0:f.setFloat64(m,c);m+=8;break;case 1:f.setFloat32(m,c);m+=4;break;case 2:f.setInt16(m,c);m+=2;break;case 3:f.setUint8(m,c);m+=1;break;default:f.setFloat32(m,c),m+=4}return m}cd(f){if(2!==this.sc)return f;2===this.lb?f=(f/32767+1)*Math.PI:3===this.lb&&(f=f/255*a);return f}static $c(f,m,c,d,p){switch(f){case 0:return p?c:m;case 1:return m+d*(c-m);case 2:return m===c?f=0:(f=Math.sin(m)*Math.sin(c)+Math.cos(m)*Math.cos(c),f=1<=f?0:
-1>=f?Math.PI:Math.acos(f)),m=0>=Math.cos(c)*Math.sin(m)-Math.sin(c)*Math.cos(m)?b(m+f*d):b(m-f*d);default:return p?c:m}}}class k{constructor(f,m){this.timestamp=f;this.data=m}}class u{constructor(f,m,c){this.va=f;this.b=f.b;this.H=m;this.V=c;this._data=[];this._data.length=this.va.ya.length;this.mf=this.Ed=0;this.Jg=this.Td=!1;this.ca=[];this.N=this.C=this.Ga=null}Hb(){var f=[];for(let c=0,d=this.va.ya.length;c<d;++c)f.push(this.gb(this.va.Pd,c));f={id:this.H,nid:this.V,isTimedOut:this.pi(),interpValues:f,
latestUpdate:null};const m=this.bi();m&&(f.latestUpdate={timestamp:m.timestamp,data:m.data});return f}Zf(f){this.Jg=!!f}ue(f,m){f=f.netValues;var c=this.va.ya;const d=c.length;this.Td=!1;for(let p=0;p<d;++p){const v=c[p].Lf(f[p]);this._data[p]!==v&&(this._data[p]=v,this.Ed=m,this.va.Oi(m))}f=m-this.Ed;m-=this.mf;c=this.va.Ag;(this.Td=100>f&&0===c?!0:1E3>f&&1>=c?95<=m:495<=m)&&this.va.mi()}we(f,m,c){const d=this.va.ya;this.mf=c;f.setUint16(m,this.V);m+=2;for(let p=0,v=this._data.length;p<v;++p)m=d[p].eg(f,
m,this._data[p]);return m}Zd(f,m){for(let c=0,d=this.ca.length;c<d;++c){const p=this.ca[c];if(p.timestamp===f)return;if(p.timestamp>f){this.ca.splice(c,0,new k(f,m));return}}this.ca.push(new k(f,m))}pi(){return 0===this.ca.length?!1:this.ca[this.ca.length-1].timestamp<this.va.Pd-3E3}la(){for(;2<this.ca.length&&this.ca[0]!==this.Ga&&this.ca[0]!==this.C&&this.ca[0]!==this.N;)this.ca.shift();const f=this.va.Pd;if(!(this.N&&this.N.timestamp>f&&this.C&&this.C.timestamp<f)){this.N=null;for(let m=0,c=this.ca.length;m<
c;++m){const d=this.ca[m];if(d.timestamp<=f){if(!this.C||d.timestamp>this.C.timestamp)this.Ga=this.C,this.C=d}else{this.N=d;break}}}}bi(){return 0===this.ca.length?null:this.ca[this.ca.length-1]}gb(f,m){if(!this.N&&!this.C)return 0;if(this.N&&!this.C)return this.N.data[m];const c=this.va.ya;let d,p,v;if(!this.N&&this.C){if(this.Ga){var w=this.Ga.timestamp;d=this.Ga.data[m];p=this.C.timestamp;v=this.C.data[m];f>this.C.timestamp+this.va.Ad&&(f=this.C.timestamp+this.va.Ad);w=w===p?0:(f-w)/(p-w);return e.$c(c[m].gb(),
d,v,w,!0)}return this.C.data[m]}w=this.C.timestamp;d=this.C.data[m];p=this.N.timestamp;v=this.N.data[m];w=w===p?0:(f-w)/(p-w);return e.$c(c[m].gb(),d,v,w,!1)}}class n{constructor(f,m,c,d){this.b=f;this.Oc=m;this.Pc=c;this.V=this.b.fi();this.Ag=d;this.Vd={};this.Qa=0;this.Ad=250;switch(this.Ag){case 1:this.Ad=500;break;case 2:this.Ad=2500}this.ya=[];this.Ea=[];this.Ab=new Map;this.Xb=new Set;this.Gc=this.mf=this.Ed=this.Ec=0;this.Mb=!1;this.vd=[];this.Fc=new Map;this.Pd=0;this.b.rh(this)}ub(f){this.V=
f}Oi(f){this.Ed=f}mi(){this.Gc++}ll(){this.Mb=!0}fb(f,m,c,d,p){f=new e(this.ya.length,f,m,c,d,p);switch(m){case 0:this.Qa+=8;break;case 1:this.Qa+=4;break;case 2:this.Qa+=2;break;case 3:this.Qa+=1}this.ya.push(f)}Zd(f,m,c){this.di(m).Zd(f,c)}la(){this.Pd=this.b.Zc();for(const f of this.Ea)f.la()}ei(){const f=[];for(const m of this.ya){const c={tag:m.ba,precision:m.lb,interp:m.gb(),clientvaluetag:m.Eg};m.li()&&(c.userdata=m.Vd);f.push(c)}return f}Qi(f){this.Qa=this.ya.length=0;for(const m of f)this.fb(m.interp,
m.precision,m.tag,m.userdata,m.clientvaluetag)}di(f){let m=this.Fc.get(f);if(m)return m;m=new u(this,-1,f);this.Fc.set(f,m);this.Ea.push(m);return m}ci(f){let m=this.Ab.get(f);if(m)return m;m=new u(this,f,this.th());this.Ab.set(f,m);this.Ea.push(m);return m}th(){do this.Ec++,65535<this.Ec&&(this.Ec=0);while(this.Xb.has(this.Ec));const f=this.Ec;this.Xb.add(f);return f}le(f){const m=f.H,c=f.V;this.b.j()&&!this.Mb&&this.vd.push(c);this.Ab.delete(m);this.Fc.delete(c);this.Xb.delete(c);f=this.Ea.indexOf(f);
-1<f&&this.Ea.splice(f,1)}Mh(){this.vd.length=0;this.Ab.clear();this.Fc.clear();this.Xb.clear();this.Ea.length=0}ue(f,m){this.Gc=0;for(var c of this.Ea)c.Zf(!1);for(let d=0,p=f.length;d<p;++d){c=f[d];const v=this.ci(c.uid);v.Zf(!0);v.ue(c,m)}for(const d of this.Ea)d.Jg||g.push(d);for(const d of g)this.le(d);g.length=0}we(f,m,c){f.setUint16(m,this.V);m+=2;let d=0;this.Mb&&(d=1);f.setUint8(m,d);m+=1;f.setUint16(m,this.Gc);m+=2;f.setUint16(m,this.Qa);m+=2;for(const p of this.Ea)p.Td&&(m=p.we(f,m,c));
return m}Gi(f,m){if(this.Ab.has(f))console.warn("OverrideNid passed id "+f+" which is already in use and cannot be overridden");else if(this.Xb.has(m))console.warn("OverrideNid passed nid "+m+" which is already in use and cannot be overridden");else{var c=new u(this,f,m);this.Ab.set(f,c);this.Xb.add(m);this.Ea.push(c);this.Mb=!0}}me(f){(f=this.Ab.get(f))&&this.le(f)}ne(f){(f=this.Fc.get(f))&&this.le(f)}Hb(){return{hasOverriddenNids:this.Mb,netValues:this.ya.map(f=>f.Hb()),netInstances:this.Ea.map(f=>
f.Hb())}}ii(){return{roId:this.Oc,sid:this.Pc,netValues:this.ya.map(f=>f.Hb())}}}self.Kf=e;self.Hh=k;self.Jh=n}"use strict";
{const g=self.Hh,a=self.Kf,b=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection;function e(n){if(n)try{n.close()}catch(f){}}const k=[];class u{constructor(n,f,m){this.b=n;this.H=f;this.V=0;this.fa=m;this.wb=this.L=null;this.tc=!1;this.xb=null;this.vc=!1;this.yb=null;this.af=this.Rc=this.pc=this.Lb=this.wc=!1;this.zd=this.Fg=this.jf=0;this.Sg=[];this.Pg=this.Og=0;this.xa=[];this.N=this.C=this.Ga=null;this.Mg=0;this.Te=!1;this.lf=1;this.Fd=
[];this.Vg=this.Gd=0;this.b.jj(this)}ub(n){this.V=n}j(){return this===this.b.R}ad(){return this===this.b.P}nl(){this.Og=performance.now()}ol(n){this.Pg=n}hd(n,f){n.binaryType="arraybuffer";n.onopen=()=>{"o"===f?this.tc=!0:"r"===f?this.vc=!0:"u"===f&&(this.wc=!0);this.Oj()};n.onmessage=m=>{this.jk(f,m)};n.onerror=m=>{console.error("Peer '"+this.H+"' datachannel '"+f+"' error: ",m);this.b.Ka(this,m);this.b.j()&&!this.j()&&this.T("network error")};n.onclose=()=>{this.T("disconnect")}}Mf(){if(!this.ad()){var n=
this.b.j();this.pc=this.Lb=this.wc=this.vc=this.tc=!1;this.Fg=performance.now();this.L=new b({iceServers:this.b.ef});this.L.onicecandidate=m=>{m.candidate&&this.b.Ja({message:"icecandidate",toclientid:this.H,icecandidate:m.candidate})};this.L.onsignalingstatechange=()=>{this.L&&"closed"===this.L.signalingState&&this.T("disconnect")};this.L.oniceconnectionstatechange=()=>{this.L&&("failed"!==this.L.iceConnectionState&&"closed"!==this.L.iceConnectionState||this.T("disconnect"))};this.L.onconnectionstatechange=
()=>{if(this.L){var m=this.L.connectionState;"failed"!==m&&"closed"!==m||this.T("disconnect")}};var f=`c2mp_${this.b.Wh()}_${this.b.Xh()}_${this.b.Yh()}`;n?(this.V=this.b.Gf(),this.wb=this.L.createDataChannel("o",{ordered:!0,protocol:f}),this.hd(this.wb,"o"),this.xb=this.L.createDataChannel("r",{ordered:!1,protocol:f}),this.hd(this.xb,"r"),this.yb=this.L.createDataChannel("u",{ordered:!1,maxRetransmits:0,protocol:f}),this.hd(this.yb,"u"),this.L.createOffer().then(m=>{this.L.setLocalDescription(m);
this.b.Ja({message:"offer",toclientid:this.H,offer:m})}).catch(m=>{console.error("Host error creating offer for peer '"+this.H+"': ",m);this.b.Ka(this,"could not create offer for peer")})):this.L.ondatachannel=m=>{if(m.channel.protocol!==f)console.error("Unexpected datachannel protocol '"+m.channel.protocol+"', should be '"+f+"'"),this.b.Ka(this,"unexpected datachannel protocol '"+m.channel.protocol+"', should be '"+f+"'");else{var c=m.channel.label;"o"===c?this.wb=m.channel:"r"===c?this.xb=m.channel:
"u"===c?this.yb=m.channel:(console.error("Unknown datachannel label: "+m.channel.label),this.b.Ka(this,"unknown datachannel label '"+m.channel.label+"'"));this.hd(m.channel,c)}}}}async ij(n){if(this.L)try{await this.L.addIceCandidate(n)}catch(f){console.warn("[Multiplayer] Error adding ICE candidate: ",f)}}ki(){return!!this.L}Oj(){!this.Lb&&this.vc&&this.wc&&this.tc&&(this.nk(),this.Lb=!0,this.pc=!1)}nk(){this.jf=performance.now();if(this.b.j()){this.b.ac("o",JSON.stringify({c:"j",i:this.H,n:this.V,
a:this.fa}),this);this.hb("o",JSON.stringify({c:"hi",hn:this.b.R.V,n:this.V,d:this.b.Ba,u:this.b.Ic,objs:this.b.hi(),cvs:this.b.Vh()}));for(const n of this.b.Ma)!n.j()&&n!==this&&n.he()&&this.hb("o",JSON.stringify({c:"j",i:n.H,n:n.V,a:n.fa}))}else this.af=!0,this.j()&&this.pe(performance.now(),!0);this.b.sg(this)}Nj(n){!this.pc&&this.Lb&&(this.He(n),this.pc=!0,this.Lb=!1)}He(n){this.b.j()&&!this.ad()&&this.b.ac("o",JSON.stringify({c:"l",i:this.H,a:this.fa,r:n}),this);this.ad()||this.b.rg(this,n)}he(){return this.Lb&&
!this.pc}hb(n,f){this.b.ej();var m=0;f.length?m=f.length:f.byteLength&&(m=f.byteLength);this.b.cj(m);m=this.b.yf;const c=this.b.xf,d=this.b.zf;if(!(0<m&&"u"===n&&Math.random()<m))if(0===c&&0===d)this.ig(n,f);else{let p=1;"u"!==n&&Math.random()<m&&(p=3);setTimeout(()=>this.ig(n,f),c*p+Math.random()*d*p)}}ig(n,f){try{"o"===n?this.tc&&this.wb&&this.wb.send(f):"r"===n?this.vc&&this.xb&&this.xb.send(f):"u"===n&&this.wc&&this.yb&&this.yb.send(f)}catch(m){this.Rc||(this.b.j()?"o"===n||"r"===n?("string"===
typeof f?(console.error("Error sending "+f.length+"-char string on '"+n+"' to '"+this.fa+"', host kicking: ",m),console.log("String that failed to send from previous error was: "+f)):console.error("Error sending "+(f.length||f.byteLength)+"-byte binary on '"+n+"' to '"+this.fa+"', host kicking: ",m),this.T("network error")):(this.zd++,10<=this.zd&&("string"===typeof f?(console.error("Too many errors ("+this.zd+") sending data on '"+n+"' to '"+this.fa+"', kicking; last error was for sending "+f.length+
"-char string: ",m),console.log("String that failed to send from previous error was: "+f)):console.error("Too many errors ("+this.zd+") sending data on '"+n+"' to '"+this.fa+"', kicking; last error was for sending "+(f.length||f.byteLength)+"-byte binary: ",m),this.T("network error"))):console.error("Error sending data on '"+n+"': ",m))}}pe(n,f){this.Rc||(!f&&!this.he()&&this.L&&25E3<n-this.Fg?(console.warn("Timed out '"+this.fa+"', could not establish connection after 25sec"),this.T("timeout")):
!f&&this.he()&&2E4<n-this.jf?(console.warn("Timed out '"+this.fa+"', not heard from for 20sec"),this.T("timeout")):(this.Mg=n,this.Te=!0,this.lf++,this.hb("u","ping:"+this.lf)))}Ki(n){n="pong:"+n.substr(5);this.b.j()&&(n=n+"/"+Math.round(performance.now()).toString());this.hb("u",n)}sk(n){if(this.Te){var f=n.indexOf(":");if(-1<f){if(parseFloat(n.substr(f+1))===this.lf){f=performance.now();this.Te=!1;var m=(f-this.Mg)/2;this.Fd.push(m);10<this.Fd.length&&this.Fd.shift();k.push(...this.Fd);k.sort((v,
w)=>v-w);this.Vg=k[k.length-1]-k[0];var c=0,d=k.length;4<=k.length&&6>=k.length?(++c,--d):6<k.length&&(c+=2,d-=2);var p=0;for(let v=c;v<d;++v)p+=k[v];this.Gd=p/(d-c);k.length=0;this.b.j()||(c=n.indexOf("/"),-1<c?(n=parseFloat(n.substr(c+1)),isFinite(n)?this.b.qh(n,f,m,this.Gd):console.warn("Invalid host time from pong response")):console.warn("Cannot parse off host time from pong response"))}}else console.warn("Cannot parse off ping ID from pong")}}jk(n,f){const m=this.b.yf,c=this.b.xf,d=this.b.zf;
if(!(0<m&&"u"===n&&Math.random()<m))if(0===c&&0===d)this.hg(n,f);else{let p=1;"u"!==n&&Math.random()<m&&(p=3);setTimeout(()=>this.hg(n,f),c*p+Math.random()*d*p)}}hg(n,f){if(!this.Rc){this.jf=performance.now();this.b.dj();var m=0;f.data.length?m=f.data.length:f.data.byteLength&&(m=f.data.byteLength);this.b.bj(m);if("string"===typeof f.data){if(!(""===f.data.trim()||4>f.data.length))if(n=f.data.substr(0,4),"ping"===n)this.Ki(f.data);else if("pong"===n)this.sk(f.data);else{try{var c=JSON.parse(f.data)}catch(d){this.b.Ka(this,
d);this.b.j()?(console.error("Error parsing message as JSON for peer '"+this.H+"', host kicking: ",d),this.T("data error")):console.error("Error parsing message as JSON for peer '"+this.H+"': ",d);console.log("String that failed to parse from previous error: "+f.data);return}if(c)try{c.c&&"m"!==c.c?this.Tj(c):this.b.pk(this,c)}catch(d){this.b.Ka(this,d),this.b.j()?(console.error("Error handling message for peer '"+this.H+"', host kicking: ",d),this.T("data error")):console.error("Error handling message for peer '"+
this.H+"': ",d)}}}else{!this.af&&this.b.j()&&"u"===n&&(this.af=!0,this.b.Wi(this.H));try{this.Sj(f.data)}catch(d){this.b.Ka(this,d),this.b.j()?(console.error("Error handling binary update for peer '"+this.H+"', host kicking: ",d),this.T("data error")):console.error("Error handling binary update for peer '"+this.H+"': ",d)}}}}Tj(n){switch(n.c){case "disconnect":n.k&&y(this.b,"peer-kicked");var f=!this.b.j()&&!this.j();this.T(n.r);f&&this.b.se();break;case "hi":this.b.j()||(this.b.R.ub(n.hn),this.b.P.ub(n.n),
this.b.Ni(n.d),this.b.Si(n.u),this.b.xi(n.objs),this.b.wi(n.cvs));break;case "j":this.b.j()||(f=new u(this.b,n.i,n.a),f.ub(n.n),this.b.sg(f));break;case "l":!this.b.j()&&(f=this.b.Yc(n.i))&&(f.ad()||this.b.rg(f,n.r),f.T(n.r));break;default:console.error("Unknown control message from peer '"+this.H+"': "+n.c),this.b.Ka(this,"unknown control message '"+n.c+"'")}}Sj(n){this.b.j()?this.ek(n):this.qk(n)}ek(n){n=new DataView(n);let f=0;var m=n.getUint32(f);f+=4;if(1664249200!==m)console.warn("Rejected packet with incorrect magic number (received '"+
m+"', expected '1664249200'");else if(m=n.getFloat64(f),f+=8,m+=this.Gd,!(3E3<=Math.abs(m-performance.now()))){n.getUint8(f);f+=1;var c=n.getUint8(f);f+=1;var d=[],p=this.b.La;for(let w=0;w<c;++w)if(w>=p.length)d.push(0);else{var v=p[w];switch(v.lb){case 0:v=n.getFloat64(f);f+=8;break;case 1:v=n.getFloat32(f);f+=4;break;case 2:v=v.cd(n.getInt16(f));f+=2;break;case 3:v=v.cd(n.getUint8(f));f+=1;break;default:v=n.getFloat32(f),f+=4}d.push(v)}this.hj(m,d)}}hj(n,f){for(let m=0,c=this.xa.length;m<c;++m){const d=
this.xa[m];if(d.timestamp===n)return;if(d.timestamp>n){this.xa.splice(m,0,new g(n,f));return}}this.xa.push(new g(n,f))}la(n){if(0!==this.xa.length){for(;2<this.xa.length&&this.xa[0]!==this.Ga&&this.xa[0]!==this.C&&this.xa[0]!==this.N;)this.xa.shift();if(!(this.N&&this.N.timestamp>n&&this.C&&this.C.timestamp<n)){this.N=null;for(let f=0,m=this.xa.length;f<m;++f){const c=this.xa[f];if(c.timestamp<=n){if(!this.C||c.timestamp>this.C.timestamp)this.Ga=this.C,this.C=c}else{this.N=c;break}}}}}qk(n){n=new DataView(n);
let f=0;var m=n.getUint32(f);f+=4;1664249200!==m?console.warn("Rejected packet with incorrect magic number (received '"+m+"', expected '1664249200'"):(m=n.getUint32(f),f+=4,0===m?this.Ij(n,f):1===m?this.Hj(n,f):console.warn("Ignoring packet with incorrect flags (received "+m+", expected 0 or 1"))}Ij(n,f){const m=n.getFloat64(f);f+=8;const c=n.getUint16(f);f+=2;for(let w=0;w<c;++w){var d=n.getUint16(f);f+=2;var p=n.getUint8(f);f+=1;let z=null,F=0;const E=this.b.Sf(d);E?(z=E.ya,F=z.length,1===p&&E.ll()):
console.warn("Don't know which object corresponds to NID "+d);d=n.getUint16(f);f+=2;p=n.getUint16(f);f+=2;for(let H=0;H<d;++H){const l=n.getUint16(f);f+=2;if(E){const q=[];let h=f;for(let r=0;r<F;++r){var v=z[r];switch(v.lb){case 0:v=n.getFloat64(h);h+=8;break;case 1:v=n.getFloat32(h);h+=4;break;case 2:v=v.cd(n.getInt16(h));h+=2;break;case 3:v=v.cd(n.getUint8(h));h+=1;break;default:v=n.getFloat32(h),h+=4}q.push(v)}E.Zd(m,l,q)}f+=p}}}Hj(n,f){const m=n.getFloat64(f);f+=8;const c=n.getUint16(f);f+=2;
for(let p=0;p<c;++p){var d=n.getUint16(f);f+=2;const v=this.b.Sf(d);v||console.warn("Don't know which object corresponds to NID "+d);d=n.getUint16(f);f+=2;for(let w=0;w<d;++w){const z=n.getUint16(f);f+=2;v&&!v.Mb&&(this.b.gk(v,z,m),v.ne(z))}}}T(n,f){if(!this.Rc){this.Rc=!0;this.Nj(n);this.hb("o",JSON.stringify({c:"disconnect",r:n,k:!!f}));var m=this.wb,c=this.xb,d=this.yb,p=this.L;setTimeout(()=>{e(m);e(c);e(d);e(p)},0);this.L=this.yb=this.xb=this.wb=null;this.wc=this.vc=this.tc=!1;this.b.$k(this)}}ai(n){n=
n.rc;if(!this.N&&!this.C)return 0;if(this.N&&!this.C){var f=this.N.data;return 0>n||n>=f.length?0:f[n]}var m=this.b.Zc();let c,d;if(!this.N&&this.C){if(this.Ga){var p=this.Ga.timestamp;f=this.Ga.data[n];c=this.C.timestamp;d=this.C.data[n];m>this.C.timestamp+250&&(m=this.C.timestamp+250);p=p===c?0:(m-p)/(c-p);return a.$c(this.b.La[n].gb(),f,d,p,!0)}f=this.C.data;return 0>n||n>=f.length?0:f[n]}p=this.C.timestamp;f=this.C.data[n];c=this.N.timestamp;d=this.N.data[n];p=p===c?0:(m-p)/(c-p);return a.$c(this.b.La[n].gb(),
f,d,p,!1)}}self.Ih=u}"use strict";
{const g=self.Kf,a=self.Ih,b=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection,e=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.mozRTCSessionDescription||window.msRTCSessionDescription,k=window.RTCIceCandidate||window.webkitRTCIceCandidate||window.mozRTCIceCandidate||window.msRTCIceCandidate,u=window.RTCDataChannel||window.webkitRTCDataChannel||window.mozRTCDataChannel||window.msRTCDataChannel,n=[{urls:"stun:stun.l.google.com:19302"}];
let f=!1;const m=[];self.ra.Ha(class extends self.Ia{constructor(c){super(c,"multiplayer");this.ef=[];this.W=null;this.ua=this.Ra=!1;this.Sl={nh:0,version:0,name:"",jh:"",ih:""};this.ma=this.Ze=this.Ye=this.rf=this.sf="";this.Ma=[];this.ab=new Map;this.Qb=0;this.Ud=new Set;this.R=this.P=null;this.Ba=80;this.Ic=this.df=30;this.Rg=0;this.Eb={Uc:0,lh:0,Df:0,kh:0,Yd:0,gh:0,Cf:0,fh:0,Xd:0};this.ud=new ArrayBuffer(262144);this.We=new DataView(this.ud);this.Aa=[];this.Pl=1;this.Lc=new Map;this.Mc=new Map;
this.yf=this.zf=this.xf=0;this.Bb=[];this.ea=this.Ta=0;this.na=this.cb=this.Ba;this.La=[];this.td=new Map;this.vf=!1;this.Fe(n);setInterval(()=>this.xj(),2E3);window.addEventListener("unload",()=>this.ec("quit"));J(this,"get-supported",()=>this.bk());J(this,"add-ice-servers",d=>this.Fe(d.list));J(this,"simulate-latency",d=>this.Pi(d.latency,d.pdv,d.loss));J(this,"set-bandwidth-profile",d=>this.Mi(d.updateRate,d.delay));J(this,"tick",d=>this.la(d));J(this,"alert",d=>this.sh(d));J(this,"signalling-connect",
d=>this.Xi(d.url));J(this,"signalling-disconnect",()=>this.dg());J(this,"signalling-login",d=>this.Zi(d.alias));J(this,"signalling-join-room",d=>this.Yi(d.game,d.instance,d.room,d.maxClients));J(this,"signalling-auto-join-room",d=>this.Vi(d.game,d.instance,d.room,d.maxClients,d.lock));J(this,"signalling-leave-room",()=>this.se());J(this,"signalling-list-game-instances",d=>this.$i(d.game));J(this,"signalling-list-rooms",d=>this.aj(d.game,d.instance,d.which));J(this,"disconnect-room",()=>this.Qf(!0));
J(this,"peer-send-message",d=>this.Bi(d));J(this,"host-broadcast",d=>this.zi(d));J(this,"kick-peer",d=>this.Ai(d));J(this,"sync-object",d=>this.Fi(d));J(this,"sync-inst-var",d=>this.Ei(d));J(this,"associate-object",d=>this.yi(d));J(this,"remove-object-id",d=>this.me(d.uid));J(this,"remove-net-insts",d=>this.Ci(d));J(this,"remove-object-nid",d=>this.Di(d));J(this,"set-client-state",d=>this.$f(d.tag,d.value));J(this,"add-client-input-value",d=>this.oh(d.tag,d.precision,d.interp))}Dj(c){return c?"string"===
typeof c?c:"string"===typeof c.message?c.message:"string"===typeof c.details?c.details:"string"===typeof c.data?c.data:"string"===typeof c.type?c.type:"unknown error":"unknown error"}ge(){return this.Ra&&this.ua}cc(){return this.ge()&&this.ma}j(){return this.cc()&&this.P&&this.R===this.P}Wh(){return this.ge()?this.Ye:""}Xh(){return this.ge()?this.Ze:""}Yh(){return this.cc()?this.ma:""}Pi(c,d,p){this.xf=Math.max(c,0);this.zf=Math.max(d,0);this.yf=Math.max(p,0)}bk(){return{isSupported:!(!b||!u)}}Xi(c){if(!this.W&&
!this.Ra){try{this.W=new WebSocket(c,"c2multiplayer")}catch(d){this.W=null;this.tb(d);return}this.W.onopen=()=>{-1===this.W.protocol.indexOf("c2multiplayer")?(this.tb("server does not support 'c2multiplayer' protocol"),this.W.close(1002,"'c2multiplayer' protocol required"),this.W=null,this.Ra=!1):this.Ra=!0};this.W.onclose=()=>{this.Dk();this.ua=this.Ra=!1;this.W=null};this.W.onerror=d=>{console.error("Signalling server error: ",d);this.tb(d)};this.W.onmessage=d=>{this.Ek(d)}}}dg(){this.W&&this.Ra&&
(this.W.close(),this.W=null,this.Ra=!1)}Ek(c){let d;try{d=JSON.parse(c.data)}catch(p){this.tb(p);return}switch(d.message){case "welcome":this.Qk(d);break;case "login-ok":this.Lk(d);break;case "join-ok":this.Ik(d);break;case "leave-ok":this.Kk();break;case "kicked":this.Jk();break;case "peer-joined":this.Nk(d);break;case "peer-quit":this.Ok(d);break;case "icecandidate":this.Gk(d);break;case "offer":this.Mk(d);break;case "answer":this.Fk(d);break;case "instance-list":this.Hk(d);break;case "room-list":this.Pk(d);
break;case "error":this.tb(d.details);break;default:this.tb("received unknown signalling message")}}ji(c){for(const d of this.ef)if(d.urls===c.urls)return!0;return!1}Fe(c){if(c)for(let d of c)"string"===typeof d&&(d={urls:d}),this.ji(d)||(d.hasOwnProperty("url")||(d.url=d.urls),this.ef.push(d))}tb(c){y(this,"signalling-error",{message:this.Dj(c)})}Dk(){y(this,"signalling-close")}Qk(c){if(1>c.protocolrev||1<c.protocolrev)this.tb("signalling server protocol revision not supported"),this.dg();else{this.sf=
c.clientid;var d=this.Sl;d.nh=c.protocolrev;d.version=c.version;d.name=c.name;d.jh=c.operator;d.ih=c.motd;this.Fe(c.ice_servers);y(this,"signalling-welcome",{myid:this.sf,sigservinfo:{protocolrev:d.nh,version:d.version,name:d.name,operator:d.jh,motd:d.ih}})}}Lk(c){this.rf=c.alias;this.ua=!0;y(this,"signalling-login-ok",{myalias:this.rf})}fi(){return this.Pl++}Gf(){if(this.j()){do this.Qb++,65535<this.Qb&&(this.Qb=0);while(this.Ud.has(this.Qb));var c=this.Qb;this.Ud.add(c);return c}}Th(c){this.j()&&
this.Ud.delete(c)}Ik(c){this.ec("disconnect");this.Ye=c.game;this.Ze=c.instance;this.ma=c.room;this.P=new a(this,this.sf,this.rf);c.host?(this.R=this.P,this.Qb=0,this.Ud.clear(),this.R.ub(this.Gf())):(this.ea=this.Ta=this.Bb.length=0,this.Ba=80,this.Ic=this.df=30,this.na=this.cb=this.Ba,this.R=new a(this,c.hostid,c.hostalias),this.R.Mf());y(this,"signalling-join-ok",{isHost:!!c.host,hostId:this.R.H,hostAlias:this.R.fa,game:this.Ye,gameInstance:this.Ze,room:this.ma})}Kk(){this.ma="";y(this,"signalling-leave-ok")}Jk(){this.Qf();
this.ma="";y(this,"signalling-kicked")}Nk(c){if(this.ua&&this.ma&&this.j()){var d=this.ab.get(c.peerid);d&&d.T("rejoin");(new a(this,c.peerid,c.peeralias)).Mf()}}Ok(c){if(this.ua&&this.ma&&this.j()){var d=this.ab.get(c.id);d&&d.T(c.reason)}}Gk(c){if(this.ua&&this.ma){var d=this.ab.get(c.from);d&&d.ij(new k(c.icecandidate))}}Mk(c){if(this.ua&&this.ma&&!this.j()&&this.P&&this.R&&this.R.ki()&&c.from===this.R.H){var d=this.R.L;d.setRemoteDescription(new e(c.offer)).then(()=>{d.createAnswer().then(p=>
{d.setLocalDescription(p);this.Ja({message:"answer",toclientid:this.R.H,answer:p})}).catch(p=>{console.error("Peer error creating answer: ",p);this.Ka(this.P,"could not create answer to host offer")})}).catch(p=>{console.error("Peer error setting remote description: ",p);this.Ka(this.P,"could not set remote description")})}}Fk(c){if(this.ua&&this.ma&&this.j()){var d=this.ab.get(c.from);d&&d.L.setRemoteDescription(new e(c.answer)).catch(p=>{console.error("Host error setting remote description: ",p)})}}Hk(c){y(this,
"signalling-instance-list",{list:c.list})}Pk(c){y(this,"signalling-room-list",{list:c.list})}Ja(c){this.W&&this.Ra&&this.W.send(JSON.stringify(c))}Zi(c){this.ua||this.Ja({message:"login",protocolrev:1,alias:c})}Yi(c,d,p,v){this.ua&&!this.ma&&this.Ja({message:"join",game:c,instance:d,room:p,max_clients:v})}Vi(c,d,p,v,w){this.ua&&!this.ma&&this.Ja({message:"auto-join",game:c,instance:d,room:p,max_clients:v,lock_when_full:w})}se(){this.ua&&this.Ja({message:"leave"})}Wi(c){this.ua&&this.j()&&this.Ja({message:"confirm-peer",
id:c})}$i(c){this.W&&this.Ra&&this.Ja({message:"list-instances",game:c})}aj(c,d,p){this.W&&this.Ra&&this.Ja({message:"list-rooms",game:c,instance:d,which:p})}Qf(c){this.ea=this.Ta=this.Bb.length=0;this.ec("disconnect");for(const d of this.Aa)d.Mh();c&&this.se()}jj(c){this.Ma.push(c);this.ab.set(c.H,c);y(this,"add-peer",{id:c.H,alias:c.fa})}$k(c){y(this,"remove-peer",{id:c.H});this.j()&&this.Th(c.V);const d=this.Ma.indexOf(c);-1<d&&this.Ma.splice(d,1);this.ab.delete(c.H);this.R===c&&(this.R=null,this.ec("host quit"));
this.P===c&&(this.P=null,this.ma="",this.ec("disconnect"))}ec(c){if(!f){for(f=!0;this.Ma.length;)this.Ma[0].T(c);f=!1}}Yc(c){return this.ab.get(c)||null}Uh(c){return(c=this.ab.get(c))?c.fa:""}zi(c){const d=c.fromId,p=c.tag,v=c.message;c=c.mode;const w=this.Yc(d);this.ac(c,JSON.stringify({c:"m",t:p,f:d,m:v}),w)}ac(c,d,p){if(this.j()){var v=this.Ma.slice(0);for(const w of v)w&&w!==this.P&&w!==p&&w.hb(c,d)}}xj(){const c=performance.now();if(this.j()){m.push(...this.Ma);for(const d of m)d&&d!==this.P&&
d.pe(c,!1);m.length=0}else this.R&&this.R.pe(c,!1)}rh(c){this.Aa.push(c);this.Mc.set(c.Oc,c);this.Lc.set(c.V,c)}hi(){const c={};for(const [d,p]of this.Lc.entries())c[p.Pc]={nid:d,nvs:p.ei()};return c}xi(c){this.Lc.clear();for(const d of this.Aa)if(c.hasOwnProperty(d.Pc.toString())){const p=c[d.Pc.toString()];d.ub(p.nid);this.Lc.set(p.nid,d);d.Qi(p.nvs)}else console.warn("Could not map object SID '"+d.Pc+"' - host did not send NID for it"),d.ub(-1)}Sf(c){return this.Lc.get(c)||null}la(c){if(!this.cc())return null;
c=c.dt;const d=performance.now();d-this.Rg>=1E3/(this.j()?this.df:this.Ic)-5&&(this.Li(d),this.Rg=d);const p=this.Eb;1E3<=d-p.Uc&&(p.lh=p.Df,p.kh=p.Yd,p.gh=p.Cf,p.fh=p.Xd,p.Df=0,p.Yd=0,p.Cf=0,p.Xd=0,p.Uc+=1E3,500<d-p.Uc&&(p.Uc=d),y(this,"stats",{stats:{outboundPerSec:p.lh,outboundBandwidthPerSec:p.kh,inboundPerSec:p.gh,inboundBandwidthPerSec:p.fh}}));this.j()||(this.ea<this.Ta?(this.ea+=10*c,this.ea>this.Ta&&(this.ea=this.Ta)):this.ea>this.Ta&&(this.ea-=10*c,this.ea<this.Ta&&(this.ea=this.Ta)),this.na<
this.cb?(this.na+=30*c,this.na>this.cb&&(this.na=this.cb)):this.na>this.cb&&(this.na-=30*c,this.na<this.cb&&(this.na=this.cb)));c=this.Zc();for(const v of this.Ma)v.la(c);for(const v of this.Aa)v.la();return{simulationTime:this.Zc(),hostInputArrivalTime:this.$h(),clientDelay:this.Ba,peerData:this.Fj(),roData:this.Gj(),isReadyForInput:this.Uf()}}Fj(){const c={};for(const d of this.Ma){const p={};for(const v of this.La)p[v.ba]=d.ai(v);c[d.H]={nid:d.V,latency:d.Gd,pdv:d.Vg,clientState:p}}return c}Gj(){const c=
{};for(const d of this.Aa)c[d.Oc]=d.Hb();return c}async Li(c){this.j()?(await this.gl(c),this.fl(c)):await this.el(c)}async Qj(){const c=await A(this,"before-client-update");for(const d of c.clientStateUpdates)this.$f(d.tag,d.value)}async el(c){this.Uf()&&await this.Qj();if(this.P&&this.vf){var d=this.We,p=0,v=this.La,w=this.P.Sg,z=c-this.P.Og,F=c-this.P.Pg;if(100>z||(1E3>z?95<=F:495<=F)){d.setUint32(p,1664249200);p+=4;d.setFloat64(p,c+this.ea);p+=8;d.setUint8(p,0);p+=1;d.setUint8(p,v.length);p+=
1;for(let E=0,H=v.length;E<H;++E)z=v[E],F=0,E<w.length&&(F=z.Lf(w[E])),p=z.eg(d,p,F);this.P.ol(c);this.R.hb("u",new Uint8Array(this.ud.slice(0,p)))}}}async gl(c){const d=this.We;let p=0,v=0;const w=await A(this,"get-object-info",{ros:this.Aa.map(z=>z.ii())});for(const z of this.Aa){const F=z.Oc;w.hasOwnProperty(F)&&(z.ue(w[F],c),0<z.Gc&&v++)}if(0!==v){d.setUint32(p,1664249200);p+=4;d.setUint32(p,0);p+=4;d.setFloat64(p,c);p+=8;d.setUint16(p,v);p+=2;for(const z of this.Aa)0<z.Gc&&(p=z.we(d,p,c));this.ac("u",
new Uint8Array(this.ud.slice(0,p)),null)}}fl(c){const d=this.We;let p=0,v=0;for(const w of this.Aa)w.vd.length&&v++;if(0!==v){d.setUint32(p,1664249200);p+=4;d.setUint32(p,1);p+=4;d.setFloat64(p,c);p+=8;d.setUint16(p,v);p+=2;for(const w of this.Aa)if(c=w.vd,c.length){d.setUint16(p,w.V);p+=2;d.setUint16(p,c.length);p+=2;for(const z of c)d.setUint16(p,z),p+=2;c.length=0}this.ac("r",new Uint8Array(this.ud.slice(0,p)),null)}}qh(c,d,p,v){if(!this.j()){this.cb=v+this.Ba;c=c+p-d;0===this.Bb.length&&(this.ea=
c,this.na=this.cb);this.Bb.push(c);30<this.Bb.length&&this.Bb.shift();m.push(...this.Bb);m.sort((w,z)=>w-z);c=0;d=m.length;4<=m.length&&6>=m.length?(++c,--d):6<m.length&&19>=m.length?(c+=2,d-=2):19<m.length&&(c+=5,d-=5);p=0;for(v=c;v<d;++v)p+=m[v];this.Ta=p/(d-c);m.length=0}}Zc(){return this.j()?performance.now()-this.Ba:performance.now()+this.ea-this.na}$h(){return this.j()?performance.now():performance.now()+this.ea+this.na}$f(c,d){if(!this.j()&&this.P&&this.vf&&(c=this.td.get(c))){c=c.rc;var p=
this.P.Sg;p.length<c+1&&(p.length=c+1);p[c]!==d&&(p[c]=d,this.P.nl())}}oh(c,d,p){d=new g(this.La.length,p,d,c,null);this.td.set(c,d);this.La.push(d)}Vh(){const c=[];for(const d of this.La)c.push({tag:d.ba,precision:d.lb,interp:d.gb()});return c}wi(c){this.td.clear();this.La.length=0;for(let p=0,v=c.length;p<v;++p){var d=c[p];d=new g(p,d.interp,d.precision,d.tag,null);this.td.set(d.ba,d);this.La.push(d)}this.vf=!0}me(c){for(const d of this.Aa)d.me(c)}Uf(){return this.cc()?this.j()?!0:0!==this.Ta:!1}Mi(c,
d){this.cc()||(this.Ic=this.df=c,this.Ba=d)}sg(c){y(this,"peer-open",{id:c.H,alias:c.fa})}Bi(c){const d=c.tag,p=c.message,v=c.mode;(c=this.Yc(c.id))&&c.hb(v,JSON.stringify({c:"m",t:d,m:p}))}rg(c,d){y(this,"peer-close",{id:c.H,alias:c.fa,reason:d||"unknown"})}Ka(c,d){console.error(`[Multiplayer] Peer '${c.fa}' (${c.H}) error: `,d)}pk(c,d){c=d.f||c.H;y(this,"peer-message",{tag:d.t,fromId:c,fromAlias:this.Uh(c),content:d.m})}gk(c,d,p){y(this,"instance-destroyed",{roId:c.Oc,nid:d,timestamp:p})}Ai(c){if(this.j()){var d=
c.reason;(c=this.Yc(c.id))&&c.T(d,!0)}}ej(){this.Eb.Df++}cj(c){this.Eb.Yd+=c}dj(){this.Eb.Cf++}bj(c){this.Eb.Xd+=c}Ni(c){this.Ba=c}Si(c){this.Ic=c}Fi(c){const d=c.data,p=c.precision,v=c.bandwidth;for(const w of c.objectClasses)c=new self.Jh(this,w.roId,w.sid,v),1===d?(c.fb(1,p,"x"),c.fb(1,p,"y")):2===d?c.fb(2,p,"a"):3===d&&(c.fb(1,p,"x"),c.fb(1,p,"y"),c.fb(2,p,"a"))}sh(c){alert(c.message)}Ei(c){const d=c.precision,p=c.interp,v=c.cvt;for(const w of c.syncData)this.Mc.get(w.roId).fb(p,d,"iv",w.varIndex,
v)}yi(c){var d=c.peerId;const p=c.instUid;c=this.Mc.get(c.roId);d=this.ab.get(d);c&&d&&this.j()&&c.Gi(p,d.V)}Ci(c){for(const [d,p]of Object.entries(c))if(c=this.Mc.get(parseInt(d,10)))for(const v of p)c.ne(v)}Di(c){const d=c.nid;(c=this.Mc.get(c.roId))&&c.ne(d)}})}"use strict";
async function fa(g){if(!g.Db)try{g.Db=await navigator.wakeLock.request("screen"),g.Db.addEventListener("release",()=>{console.log("[Construct 3] Screen wake lock released");g.Db=null;y(g,"wake-lock-released")}),console.log("[Construct 3] Screen wake lock acquired"),y(g,"wake-lock-acquired")}catch(a){console.warn("[Construct 3] Failed to acquire screen wake lock: ",a),y(g,"wake-lock-error")}}
function W(){var g=document.body;const a=g.style;a.setProperty("--temp-sai-top","env(safe-area-inset-top)");a.setProperty("--temp-sai-right","env(safe-area-inset-right)");a.setProperty("--temp-sai-bottom","env(safe-area-inset-bottom)");a.setProperty("--temp-sai-left","env(safe-area-inset-left)");g=getComputedStyle(g);g=[g.getPropertyValue("--temp-sai-top"),g.getPropertyValue("--temp-sai-right"),g.getPropertyValue("--temp-sai-bottom"),g.getPropertyValue("--temp-sai-left")].map(b=>{b=parseInt(b,10);
return isFinite(b)?b:0});a.removeProperty("--temp-sai-top");a.removeProperty("--temp-sai-right");a.removeProperty("--temp-sai-bottom");a.removeProperty("--temp-sai-left");return g}
self.ra.Ha(class extends self.Ia{constructor(g){super(g,"platform-info");K(this,[["get-initial-state",()=>this.Ke()],["request-wake-lock",()=>fa(this)],["release-wake-lock",()=>{this.Db&&(this.Db.release(),this.Db=null)}]]);window.addEventListener("resize",()=>{y(this,"window-resize",{windowOuterWidth:window.outerWidth,windowOuterHeight:window.outerHeight,safeAreaInset:W()})});this.Db=null}Ke(){return{screenWidth:screen.width,screenHeight:screen.height,windowOuterWidth:window.outerWidth,windowOuterHeight:window.outerHeight,
safeAreaInset:W(),supportsWakeLock:!!navigator.wakeLock}}});"use strict";
{function g(){const a=self.RealFile||self.File;return"function"===typeof navigator.canShare&&navigator.canShare({files:[new a(["test file"],"test.txt",{})]})}self.ra.Ha(class extends self.Ia{constructor(a){super(a,"share");a=!!this.mg();this.Kl=(this.Ml="function"===typeof navigator.share)||a;this.Il=(this.Ll=g())||a;K(this,[["init",()=>this.fk()],["share",b=>this.Bk(b)],["request-rate",b=>this.vk(b)],["request-store",b=>this.Ck(b)]])}fk(){return{isSupported:this.Kl,isFilesSupported:this.Il}}mg(){return window.plugins&&
window.plugins.socialsharing}lg(){return window.cordova&&window.cordova.plugins&&window.cordova.plugins.RateApp}async Bk(a){var b=a.text;const e=a.title,k=a.url;a=a.files.slice(0);const u=0<a.length,n=this.mg();if(n){const m={};b&&(m.message=b);e&&(m.subject=e);k&&(m.url=k);if(u){b=0;for(var f of a)b+=f.size;try{const c=await this.sj(Math.floor(1.25*b));m.files=await Promise.all(a.map(d=>this.tj(d,c)))}catch(c){console.log("[Share plugin] Share failed: ",c);y(this,"share-failed");return}}n.shareWithOptions(m,
()=>{y(this,"share-completed")},c=>{console.log("[Share plugin] Share failed: ",c);y(this,"share-failed")})}else{f={};b&&(f.text=b);e&&(f.title=e);k&&(f.url=k);u&&(f.files=a);try{await navigator.share(f),y(this,"share-completed")}catch(m){console.log("[Share plugin] Share failed: ",m),y(this,"share-failed")}}}vk(a){const b=a.body,e=a.confirm,k=a.cancel;a=a.appID;const u=this.lg();u&&u.Rate(b,e,k,a)}Ck(a){a=a.appID;const b=this.lg();b&&b.Store(a)}sj(a){return new Promise((b,e)=>{window.requestFileSystem(window.TEMPORARY,
a,k=>b(k.root),e)})}tj(a,b){return new Promise((e,k)=>{b.getFile(a.name,{create:!0,exclusive:!1},u=>{const n=u.toURL();u.createWriter(f=>{f.onwriteend=()=>e(n);f.onerror=k;f.write(a)})},k)})}})}"use strict";
async function ha(g,a){const b=a.videoType,e=a.audioType;a=a.bitsPerSecond;X(g);let k=[],u=[];try{b&&(k=(await navigator.mediaDevices.getDisplayMedia({video:!0})).getVideoTracks()),e&&self.C3Audio_GetOutputStream&&(u=self.C3Audio_GetOutputStream().getAudioTracks()),g.Sa=new MediaStream([...k,...u]),g.Rd=!0,g.Sa.addEventListener("inactive",()=>{y(g,"screen-recording-stopped");Y(g)}),g.Da=new MediaRecorder(g.Sa,{mimeType:b||e,bitsPerSecond:a})}catch(n){console.error("[Game Recorder] Failed to start recording: ",
n),y(g,"error")}Z(g,b,e)}async function ia(g,a){const b=a.videoType,e=a.audioType;a=a.bitsPerSecond;X(g);if(self.C3UserMedia_GetLastMediaStream){var k=self.C3UserMedia_GetLastMediaStream();if(k){try{g.Sa=k,g.Rd=!1,g.Da=new MediaRecorder(g.Sa,{mimeType:b||e,bitsPerSecond:a})}catch(u){console.error("[Game Recorder] Failed to start recording: ",u),y(g,"error")}Z(g,b,e)}}}
function Y(g){g.Da&&(g.Da.stop(),g.Da=null);if(g.Sa){if(g.Rd){{const a=g.Sa.getTracks();for(let b=0,e=a.length;b<e;++b){const k=a[b];"video"===k.kind&&k.stop()}}}g.Sa=null}}
function ja(){navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia||navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getSupportedConstraints().mediaSource&&(navigator.mediaDevices.getDisplayMedia=function(){return navigator.mediaDevices.getUserMedia({video:{mediaSource:"screen"}})})}function X(g){Y(g);g.wf.length=0;g.yc&&(URL.revokeObjectURL(g.yc),g.yc="")}
function Z(g,a,b){g.Da.ondataavailable=e=>{g.wf.push(e.data)};g.Da.onerror=e=>{console.error("[Game Recorder] Error recording: ",e);y(g,"error")};g.Da.onwarning=e=>{console.warn("[Game Recorder] Recording warning: ",e)};g.Da.onstop=()=>{g.yc=URL.createObjectURL(new Blob(g.wf,{type:a||b}));y(g,"recording-ready",{url:g.yc})};g.Da.start()}
self.ra.Ha(class extends self.Ia{constructor(g){super(g,"game-recorder");this.Sa=this.Da=null;this.Rd=!0;this.wf=[];this.yc="";J(this,"get-supported-formats",()=>{{var a="undefined"!==typeof MediaRecorder;const b=!(!this.K.U.captureStream||!a),e=[],k=[];b&&(MediaRecorder.isTypeSupported("video/mp4")&&e.push("video/mp4"),MediaRecorder.isTypeSupported("video/webm;codecs=vp8")&&e.push("video/webm;codecs=vp8"),MediaRecorder.isTypeSupported("video/webm;codecs=vp9")&&e.push("video/webm;codecs=vp9"),MediaRecorder.isTypeSupported("audio/mp4")&&
k.push("audio/mp4"),MediaRecorder.isTypeSupported("audio/ogg;codecs=opus")&&k.push("audio/ogg;codecs=opus"),MediaRecorder.isTypeSupported("audio/webm;codecs=opus")&&k.push("audio/webm;codecs=opus"));a={isSupported:b,isMediaRecorderSupported:a,isScreenRecordingSupported:!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia||"undefined"===typeof MediaRecorder),supportedVideoFormats:e,supportedAudioFormats:k}}return a});J(this,"start-recording",a=>{{const b=a.videoType,e=a.audioType,k=a.bitsPerSecond;
a=a.framerate;X(this);let u=[],n=[];try{if(b){const f=this.K.U;u=(0<a?f.captureStream(a):f.captureStream()).getVideoTracks()}e&&self.C3Audio_GetOutputStream&&(n=self.C3Audio_GetOutputStream().getAudioTracks());this.Sa=new MediaStream([...u,...n]);this.Rd=!0;this.Da=new MediaRecorder(this.Sa,{mimeType:b||e,bitsPerSecond:k})}catch(f){console.error("[Game Recorder] Failed to start recording: ",f),y(this,"error")}Z(this,b,e)}});J(this,"start-screen-recording",a=>ha(this,a));J(this,"start-user-media-recording",
a=>ia(this,a));J(this,"stop-recording",()=>Y(this));ja()}});"use strict";async function ka(g,a){a=a.type;let b=!0;0===a?b=await la():1===a&&(b=await ma());y(g,"permission-result",{type:a,result:b})}async function la(){if(!self.DeviceOrientationEvent||!self.DeviceOrientationEvent.requestPermission)return!0;try{return"granted"===await self.DeviceOrientationEvent.requestPermission()}catch(g){return console.warn("[Touch] Failed to request orientation permission: ",g),!1}}
async function ma(){if(!self.DeviceMotionEvent||!self.DeviceMotionEvent.requestPermission)return!0;try{return"granted"===await self.DeviceMotionEvent.requestPermission()}catch(g){return console.warn("[Touch] Failed to request motion permission: ",g),!1}}self.ra.Ha(class extends self.Ia{constructor(g){super(g,"touch");J(this,"request-permission",a=>ka(this,a))}});"use strict";
{function g(b){b.stopPropagation()}function a(b){13!==b.which&&27!==b.which&&b.stopPropagation()}self.ra.Ha(class extends self.Oh{constructor(b){super(b,"text-input");P(this,"scroll-to-bottom",e=>this.zk(e))}Of(b,e){let k;const u=e.type;"textarea"===u?(k=document.createElement("textarea"),k.style.resize="none"):(k=document.createElement("input"),k.type=u);k.style.position="absolute";k.autocomplete="off";k.addEventListener("touchstart",g);k.addEventListener("touchmove",g);k.addEventListener("touchend",
g);k.addEventListener("mousedown",g);k.addEventListener("mouseup",g);k.addEventListener("keydown",a);k.addEventListener("keyup",a);k.addEventListener("click",n=>{n.stopPropagation();Q(this,"click",b)});k.addEventListener("dblclick",n=>{n.stopPropagation();Q(this,"dblclick",b)});k.addEventListener("input",()=>O(this,"change",b,{text:k.value}));e.id&&(k.id=e.id);this.ve(k,e);return k}ve(b,e){b.value=e.text;b.placeholder=e.placeholder;b.title=e.title;b.disabled=!e.isEnabled;b.readOnly=e.isReadOnly;b.spellcheck=
e.spellCheck;e=e.maxLength;0>e?b.removeAttribute("maxlength"):b.setAttribute("maxlength",e)}zk(b){b.scrollTop=b.scrollHeight}})}"use strict";self.ra.Ha(class extends self.Ia{constructor(g){super(g,"mouse");J(this,"cursor",a=>{document.documentElement.style.cursor=a})}});
